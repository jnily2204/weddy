<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Weddy - N·ªÅn t·∫£ng qu·∫£n l√Ω ƒë√°m c∆∞·ªõi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Raleway:wght@400;600;700;800&display=swap');
        body { font-family: 'Raleway', sans-serif; background-color: #F0EBE5; color: #44403C; -webkit-tap-highlight-color: transparent; }
        .font-title { font-family: 'Cormorant Garamond', serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_F3OI5GexlAqgC8TZ1CN1JB5O3RacQqs",
            authDomain: "weddyvn.firebaseapp.com",
            projectId: "weddyvn",
            storageBucket: "weddyvn.firebasestorage.app",
            messagingSenderId: "504927899297",
            appId: "1:504927899297:web:1a3d3a1b6cfafe0716aae0",
            measurementId: "G-KK4B3RXVNV"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        window.firebaseServices = { auth, db, doc, setDoc, updateDoc, onSnapshot, getDoc, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- UTILS ---
        const utils = {
            formatMoney: (a) => a ? (a).toLocaleString('vi-VN') + " VNƒê" : "0 VNƒê",
            formatInput: (v) => v ? v.toString().replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ".") : "",
            parseInput: (v) => v ? parseInt(v.toString().replace(/\./g, '')) || 0 : 0
        };

        // --- ICONS ---
        const Icon = ({ name, size = 20, className }) => {
            const icons = {
                heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />,
                check: <polyline points="20 6 9 17 4 12" />,
                plus: <path d="M5 12h14M12 5v14" />,
                x: <path d="M18 6 6 18M6 6l12 12" />,
                trash: <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>,
                share: <circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" x2="15.42" y1="13.51" y2="17.49" /><line x1="15.41" x2="8.59" y1="6.51" y2="10.49" />,
                logout: <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>,
                edit: <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
            };
            return <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name]}</svg>;
        };

        // --- COMPONENTS ---
        const Logo = () => (
            <div className="flex items-center gap-1.5 cursor-pointer" onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}>
                <span className="text-xl font-title font-black text-stone-700 tracking-tight uppercase">WEDDY</span>
            </div>
        );

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 animate-in">
                    <div className="absolute inset-0 bg-stone-900/30 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="relative bg-white rounded-[2rem] p-6 w-full max-w-md shadow-2xl border border-white max-h-[90vh] overflow-y-auto hide-scrollbar">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-lg font-bold uppercase tracking-widest text-stone-600">{title}</h3>
                            <button onClick={onClose} className="w-8 h-8 flex items-center justify-center rounded-full bg-stone-100 hover:bg-stone-200"><Icon name="x" size={16}/></button>
                        </div>
                        {children}
                    </div>
                </div>
            );
        };

        // 1. WIZARD (THI·∫æT L·∫¨P BAN ƒê·∫¶U)
        const GettingStartedWizard = ({ onComplete }) => {
            const [step, setStep] = useState(0);
            const [data, setData] = useState({ role: "", budget: "" });
            
            return (
                <div className="fixed inset-0 z-[200] bg-[#F0EBE5] flex flex-col items-center justify-center p-6 animate-in">
                    <div className="max-w-md w-full text-center">
                        <Logo />
                        <h2 className="text-2xl font-title font-bold mt-8 mb-2">Ch√†o m·ª´ng b·∫°n</h2>
                        <p className="text-stone-500 mb-8 text-sm">C√πng thi·∫øt l·∫≠p k·∫ø ho·∫°ch ƒë√°m c∆∞·ªõi nh√©.</p>
                        
                        {step === 0 && (
                            <div className="space-y-4">
                                <p className="font-bold uppercase tracking-widest text-xs text-stone-400">B·∫°n l√†?</p>
                                <div className="grid grid-cols-2 gap-4">
                                    <button onClick={()=>setData({...data, role: 'Ch√∫ r·ªÉ'})} className={`p-6 rounded-3xl border-2 transition-all ${data.role==='Ch√∫ r·ªÉ'?'border-stone-800 bg-stone-800 text-white':'border-white bg-white'}`}>ü§µ Ch√∫ r·ªÉ</button>
                                    <button onClick={()=>setData({...data, role: 'C√¥ d√¢u'})} className={`p-6 rounded-3xl border-2 transition-all ${data.role==='C√¥ d√¢u'?'border-stone-800 bg-stone-800 text-white':'border-white bg-white'}`}>üë∞ C√¥ d√¢u</button>
                                </div>
                                <button disabled={!data.role} onClick={()=>setStep(1)} className="w-full py-4 bg-stone-800 text-white rounded-full font-bold uppercase tracking-widest disabled:opacity-50 mt-4 text-xs">Ti·∫øp t·ª•c</button>
                            </div>
                        )}

                        {step === 1 && (
                            <div className="space-y-4">
                                <p className="font-bold uppercase tracking-widest text-xs text-stone-400">Ng√¢n s√°ch d·ª± ki·∫øn?</p>
                                <input type="text" value={data.budget} onChange={e=>setData({...data, budget: utils.formatInput(e.target.value)})} className="w-full p-5 text-center text-2xl font-bold rounded-3xl border-none shadow-sm focus:ring-2 ring-stone-200 outline-none" placeholder="300.000.000" />
                                <button onClick={()=>onComplete({...data, budget: utils.parseInput(data.budget)})} className="w-full py-4 bg-emerald-600 text-white rounded-full font-bold uppercase tracking-widest mt-4 text-xs">Ho√†n t·∫•t</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 2. OVERVIEW (T·ªîNG QUAN)
        const PlannerOverview = ({ spentAmount, budgetLimit, role, onInvite, onEditBudget }) => (
            <div className="max-w-4xl mx-auto space-y-6 animate-in">
                <div className="bg-white/60 backdrop-blur-md p-6 rounded-[2.5rem] border border-white flex flex-col md:flex-row items-center justify-between gap-4 shadow-sm">
                    <div className="flex items-center gap-4">
                        <div className="w-12 h-12 bg-rose-100 rounded-full flex items-center justify-center text-rose-500"><Icon name="heart" /></div>
                        <div><h4 className="font-bold">V√≠ chung ƒë√¥i m√¨nh</h4><p className="text-xs text-stone-500">K·∫øt n·ªëi k·∫ø ho·∫°ch v·ªõi b·∫°n ƒë·ªùi.</p></div>
                    </div>
                    <button onClick={onInvite} className="px-6 py-3 bg-stone-800 text-white rounded-full text-[10px] font-bold uppercase tracking-widest flex items-center gap-2"><Icon name="share" size={14}/> M·ªùi b·∫°n ƒë·ªùi</button>
                </div>
                <div className="bg-stone-800 p-8 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden">
                    <div className="relative z-10">
                        <h3 className="text-[10px] font-bold uppercase tracking-[0.2em] text-white/50 mb-6">T√†i ch√≠nh ({role})</h3>
                        <div className="text-xs uppercase font-bold text-white/30 mb-1">ƒê√£ chi ti√™u</div>
                        <div className="text-4xl md:text-6xl font-bold tracking-tighter">{utils.formatMoney(spentAmount)}</div>
                        <div className="flex items-center gap-2 mt-6 cursor-pointer opacity-60 hover:opacity-100 transition-opacity" onClick={onEditBudget}>
                            <p className="text-xs font-bold uppercase tracking-widest">Ng√¢n s√°ch: {utils.formatMoney(budgetLimit)}</p>
                            <Icon name="edit" size={12} />
                        </div>
                    </div>
                </div>
            </div>
        );

        // 3. TASKS (C√îNG VI·ªÜC)
        const PlannerTasks = ({ tasks, onAddTask, onToggleTask, onDeleteTask }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [title, setTitle] = useState("");
            const pending = tasks.filter(t => t.status !== 'done');
            const done = tasks.filter(t => t.status === 'done');
            
            return (
                <div className="max-w-4xl mx-auto space-y-6 animate-in mt-8">
                    <div className="flex justify-between items-center px-2">
                        <h3 className="text-2xl font-title font-bold text-stone-800 uppercase">Vi·ªác c·∫ßn l√†m</h3>
                        <button onClick={() => setIsOpen(true)} className="w-10 h-10 bg-stone-200 rounded-full flex items-center justify-center text-stone-600 hover:bg-stone-300 transition-colors"><Icon name="plus" /></button>
                    </div>
                    
                    <div className="space-y-3">
                        {pending.length === 0 && done.length === 0 && <p className="text-center text-stone-400 text-sm py-10">Ch∆∞a c√≥ c√¥ng vi·ªác n√†o.</p>}
                        {pending.map(task => (
                            <div key={task.id} className="p-5 bg-white rounded-[2rem] border border-stone-100 flex items-center justify-between group">
                                <div className="flex items-center gap-4">
                                    <button onClick={() => onToggleTask(task.id)} className="w-6 h-6 rounded-full border-2 border-stone-200 hover:border-emerald-500 transition-colors"></button>
                                    <span className="font-bold text-sm uppercase text-stone-700">{task.title}</span>
                                </div>
                                <button onClick={() => onDeleteTask(task.id)} className="text-stone-300 hover:text-rose-500"><Icon name="trash" size={18}/></button>
                            </div>
                        ))}
                    </div>

                    {done.length > 0 && (
                        <div className="mt-8 opacity-50">
                            <h4 className="text-xs font-bold uppercase tracking-widest text-stone-400 mb-4 ml-2">ƒê√£ xong ({done.length})</h4>
                            {done.map(task => (
                                <div key={task.id} className="p-4 bg-stone-50 rounded-2xl flex items-center justify-between mb-2">
                                    <div className="flex items-center gap-4">
                                        <div className="w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center text-white"><Icon name="check" size={14}/></div>
                                        <span className="font-bold text-sm uppercase text-stone-400 line-through">{task.title}</span>
                                    </div>
                                    <button onClick={() => onDeleteTask(task.id)}><Icon name="trash" size={16} className="text-stone-300"/></button>
                                </div>
                            ))}
                        </div>
                    )}

                    <Modal isOpen={isOpen} onClose={() => setIsOpen(false)} title="Th√™m vi·ªác m·ªõi">
                        <input type="text" value={title} onChange={e=>setTitle(e.target.value)} className="w-full p-4 bg-stone-50 rounded-2xl mb-4 font-bold text-sm uppercase outline-none focus:ring-1 ring-stone-300" placeholder="Nh·∫≠p t√™n c√¥ng vi·ªác..." autoFocus />
                        <button onClick={() => { if(title) { onAddTask({title, status: 'pending', id: Date.now()}); setTitle(""); setIsOpen(false); } }} className="w-full py-4 bg-stone-800 text-white rounded-full font-bold uppercase text-xs tracking-widest">L∆∞u l·∫°i</button>
                    </Modal>
                </div>
            );
        };

        // 4. BUDGET (NG√ÇN S√ÅCH)
        const PlannerBudget = ({ tasks, onAddExpense, onDeleteTask }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [form, setForm] = useState({title: "", cost: "", paid: ""});
            const expenseTasks = tasks.filter(t => t.tag === 'expense');

            return (
                <div className="max-w-4xl mx-auto space-y-6 animate-in mt-8">
                    <div className="flex justify-between items-center px-2">
                        <h3 className="text-2xl font-title font-bold text-stone-800 uppercase">Chi ti·∫øt chi ti√™u</h3>
                        <button onClick={() => setIsOpen(true)} className="px-6 py-3 bg-stone-800 text-white rounded-full text-[10px] font-bold uppercase tracking-widest shadow-lg flex items-center gap-2">
                            <Icon name="plus" size={14}/> Th√™m kho·∫£n chi
                        </button>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {expenseTasks.length === 0 && <p className="col-span-full text-center text-stone-400 text-sm py-10">Ch∆∞a c√≥ kho·∫£n chi n√†o.</p>}
                        {expenseTasks.map(item => (
                            <div key={item.id} className="p-6 bg-white rounded-[2rem] border border-stone-100 flex justify-between items-center shadow-sm relative group">
                                <div>
                                    <h4 className="font-bold text-stone-700 uppercase text-sm">{item.title}</h4>
                                    <div className="flex gap-2 mt-2">
                                        <span className={`text-[10px] px-2 py-1 rounded uppercase font-bold ${item.status === 'done' ? 'bg-emerald-100 text-emerald-600' : 'bg-orange-100 text-orange-600'}`}>
                                            {item.status === 'done' ? 'ƒê√£ xong' : 'C√≤n n·ª£'}
                                        </span>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <p className="font-bold text-base">{utils.formatMoney(item.cost)}</p>
                                    <p className="text-[10px] text-stone-400 font-bold uppercase mt-1">ƒê√£ tr·∫£: {utils.formatMoney(item.paid || 0)}</p>
                                </div>
                                <button onClick={() => onDeleteTask(item.id)} className="absolute top-2 right-2 p-2 text-stone-200 hover:text-rose-500 transition-colors"><Icon name="trash" size={16}/></button>
                            </div>
                        ))}
                    </div>
                    <Modal isOpen={isOpen} onClose={() => setIsOpen(false)} title="Th√™m kho·∫£n chi">
                        <div className="space-y-4">
                            <input type="text" value={form.title} onChange={e=>setForm({...form, title: e.target.value})} className="w-full p-4 bg-stone-50 rounded-xl font-bold text-sm uppercase outline-none" placeholder="T√™n kho·∫£n chi (VD: V√°y c∆∞·ªõi)" />
                            <input type="text" value={form.cost} onChange={e=>setForm({...form, cost: utils.formatInput(e.target.value)})} className="w-full p-4 bg-stone-50 rounded-xl font-bold text-sm outline-none" placeholder="S·ªë ti·ªÅn d·ª± ki·∫øn" />
                            <input type="text" value={form.paid} onChange={e=>setForm({...form, paid: utils.formatInput(e.target.value)})} className="w-full p-4 bg-stone-50 rounded-xl font-bold text-sm outline-none" placeholder="ƒê√£ tr·∫£ tr∆∞·ªõc bao nhi√™u?" />
                            <button onClick={() => { 
                                if(form.title && form.cost) {
                                    const costVal = utils.parseInput(form.cost);
                                    const paidVal = utils.parseInput(form.paid);
                                    onAddExpense({
                                        title: form.title, 
                                        cost: costVal, 
                                        paid: paidVal, 
                                        status: paidVal >= costVal ? 'done' : 'pending',
                                        tag: 'expense',
                                        id: Date.now()
                                    }); 
                                    setIsOpen(false); setForm({title:"", cost:"", paid:""});
                                }
                            }} className="w-full py-4 bg-stone-800 text-white rounded-full font-bold uppercase text-xs tracking-widest">L∆∞u kho·∫£n chi</button>
                        </div>
                    </Modal>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [firebase, setFirebase] = useState(null);
            const [user, setUser] = useState(null);
            const [weddingId, setWeddingId] = useState(null);
            const [tasks, setTasks] = useState([]);
            const [weddingInfo, setWeddingInfo] = useState({ budget: 300000000, role: "" });
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('overview');
            const [showInviteModal, setShowInviteModal] = useState(false);
            const [inviteCode, setInviteCode] = useState("");
            const [showWizard, setShowWizard] = useState(false);

            // Init Firebase Services
            useEffect(() => {
                const interval = setInterval(() => {
                    if (window.firebaseServices) {
                        setFirebase(window.firebaseServices);
                        clearInterval(interval);
                    }
                }, 100);
            }, []);

            // Auth & Data Listener
            useEffect(() => {
                if (!firebase) return;
                const unsub = firebase.onAuthStateChanged(firebase.auth, async (u) => {
                    if (u) {
                        setUser(u);
                        // Get user doc to find weddingId
                        const userDoc = await firebase.getDoc(firebase.doc(firebase.db, "users", u.uid));
                        let wId = u.uid;
                        if (userDoc.exists()) {
                            wId = userDoc.data().weddingId;
                        } else {
                            // Create new user mapping
                            await firebase.setDoc(firebase.doc(firebase.db, "users", u.uid), { weddingId: u.uid, email: u.email });
                        }
                        setWeddingId(wId);
                    } else {
                        setUser(null);
                        setLoading(false);
                    }
                });
                return unsub;
            }, [firebase]);

            // Realtime Wedding Data
            useEffect(() => {
                if (!firebase || !weddingId) return;
                const unsub = firebase.onSnapshot(firebase.doc(firebase.db, "weddings", weddingId), (snap) => {
                    if (snap.exists()) {
                        const data = snap.data();
                        setTasks(data.tasks || []);
                        setWeddingInfo(data);
                        setShowWizard(false);
                    } else {
                        setShowWizard(true); // New wedding -> Show Wizard
                    }
                    setLoading(false);
                });
                return unsub;
            }, [firebase, weddingId]);

            const updateDB = async (data) => {
                if (!firebase || !weddingId) return;
                await firebase.setDoc(firebase.doc(firebase.db, "weddings", weddingId), data, { merge: true });
            };

            const handleInvite = async () => {
                const code = Math.floor(100000 + Math.random() * 900000).toString();
                await firebase.setDoc(firebase.doc(firebase.db, "inviteCodes", code), { weddingId, createdBy: user.uid });
                setInviteCode(code);
            };

            const handleJoin = async (code) => {
                const snap = await firebase.getDoc(firebase.doc(firebase.db, "inviteCodes", code));
                if (snap.exists()) {
                    const newId = snap.data().weddingId;
                    await firebase.updateDoc(firebase.doc(firebase.db, "users", user.uid), { weddingId: newId });
                    setWeddingId(newId);
                    setShowInviteModal(false);
                    alert("K·∫øt n·ªëi th√†nh c√¥ng!");
                } else { alert("M√£ kh√¥ng t·ªìn t·∫°i!"); }
            };

            if (!firebase || loading) return <div className="h-screen flex items-center justify-center font-bold uppercase tracking-widest text-stone-400 animate-pulse">ƒêang t·∫£i Weddy...</div>;

            if (!user) return (
                <div className="h-screen flex flex-col items-center justify-center p-6 text-center animate-in">
                    <Logo />
                    <h2 className="text-3xl font-title font-bold mt-8 mb-4">L√™n k·∫ø ho·∫°ch ng√†y chung ƒë√¥i</h2>
                    <p className="text-stone-500 mb-8 max-w-xs mx-auto">Qu·∫£n l√Ω m·ªçi th·ª© t·ª´ ng√¢n s√°ch ƒë·∫øn danh s√°ch vi·ªác c·∫ßn l√†m.</p>
                    <button onClick={() => firebase.signInWithPopup(firebase.auth, new firebase.GoogleAuthProvider())} className="px-8 py-4 bg-white border border-stone-200 rounded-full font-bold uppercase text-xs tracking-widest shadow-xl flex items-center gap-3 hover:scale-105 transition-transform">
                        ƒêƒÉng nh·∫≠p b·∫±ng Google
                    </button>
                </div>
            );

            return (
                <div className="min-h-screen pb-24">
                    {showWizard && <GettingStartedWizard onComplete={(d) => updateDB(d)} />}
                    
                    <nav className="sticky top-0 z-50 bg-[#F0EBE5]/90 backdrop-blur-md border-b border-white px-6 py-4 flex justify-between items-center">
                        <Logo />
                        <div className="flex gap-4 md:gap-8">
                            <button onClick={()=>setActiveTab('overview')} className={`text-[10px] font-bold uppercase tracking-widest transition-colors ${activeTab==='overview'?'text-stone-800':'text-stone-400'}`}>T·ªïng quan</button>
                            <button onClick={()=>setActiveTab('tasks')} className={`text-[10px] font-bold uppercase tracking-widest transition-colors ${activeTab==='tasks'?'text-stone-800':'text-stone-400'}`}>Vi·ªác</button>
                            <button onClick={()=>setActiveTab('budget')} className={`text-[10px] font-bold uppercase tracking-widest transition-colors ${activeTab==='budget'?'text-stone-800':'text-stone-400'}`}>Ti·ªÅn</button>
                        </div>
                        <button onClick={()=>firebase.signOut(firebase.auth)} className="text-stone-400 hover:text-rose-500"><Icon name="logout" size={18}/></button>
                    </nav>

                    <main className="pt-8 px-4 md:px-0">
                        {activeTab === 'overview' && (
                            <PlannerOverview 
                                spentAmount={tasks.filter(t=>t.tag==='expense').reduce((a,c)=>a+(c.paid||0),0)} 
                                budgetLimit={weddingInfo.budget}
                                role={weddingInfo.role}
                                onInvite={()=>setShowInviteModal(true)}
                                onEditBudget={() => { const b = prompt("Ng√¢n s√°ch m·ªõi:", weddingInfo.budget); if(b) updateDB({budget: parseInt(b.replace(/\D/g, ''))}); }}
                            />
                        )}
                        {activeTab === 'tasks' && (
                            <PlannerTasks 
                                tasks={tasks} 
                                onAddTask={(t)=>updateDB({tasks: [...tasks, t]})}
                                onToggleTask={(id)=>updateDB({tasks: tasks.map(t=>t.id===id?{...t,status:t.status==='done'?'pending':'done'}:t)})}
                                onDeleteTask={(id)=>updateDB({tasks: tasks.filter(t=>t.id!==id)})}
                            />
                        )}
                        {activeTab === 'budget' && (
                            <PlannerBudget 
                                tasks={tasks} 
                                onAddExpense={(t)=>updateDB({tasks: [...tasks, t]})}
                                onDeleteTask={(id)=>updateDB({tasks: tasks.filter(t=>t.id!==id)})}
                            />
                        )}
                    </main>

                    <Modal isOpen={showInviteModal} onClose={()=>setShowInviteModal(false)} title="K·∫øt n·ªëi b·∫°n ƒë·ªùi">
                        <div className="text-center space-y-6">
                            <div className="p-6 bg-stone-50 rounded-3xl border border-stone-200">
                                <p className="text-[10px] font-bold text-stone-400 uppercase mb-4">M√£ m·ªùi c·ªßa b·∫°n</p>
                                {inviteCode ? <div className="text-4xl font-black tracking-widest text-stone-800">{inviteCode}</div> : <button onClick={handleInvite} className="px-6 py-3 bg-stone-200 rounded-full font-bold text-xs uppercase tracking-widest">T·∫°o m√£ m·ªùi</button>}
                            </div>
                            <div className="flex gap-2">
                                <input id="joinIn" type="text" placeholder="Nh·∫≠p m√£ m·ªùi..." className="flex-1 p-4 bg-stone-50 rounded-2xl border-none text-center font-bold tracking-widest outline-none focus:ring-1 ring-stone-300" />
                                <button onClick={()=>handleJoin(document.getElementById('joinIn').value)} className="px-6 bg-stone-800 text-white rounded-2xl font-bold uppercase text-xs">OK</button>
                            </div>
                        </div>
                    </Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
