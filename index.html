<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Weddy - N·ªÅn t·∫£ng qu·∫£n l√Ω ƒë√°m c∆∞·ªõi tinh t·∫ø</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Raleway:wght@300;400;500;600;700;800;900&display=swap');
        body { font-family: 'Raleway', sans-serif; -webkit-tap-highlight-color: transparent; font-size: 16px; }
        h1, h2, h3, h4, h5, h6, .font-title { font-family: 'Cormorant Garamond', serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { 0% { opacity: 0; transform: translateY(15px); filter: blur(4px); } 100% { opacity: 1; transform: translateY(0); filter: blur(0); } }
        .animate-in { animation: fadeIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-[#F0EBE5] text-stone-700 transition-colors duration-500 overflow-x-hidden text-base">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot, getDoc, collection } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_F3OI5GexlAqgC8TZ1CN1JB5O3RacQqs",
            authDomain: "weddyvn.firebaseapp.com",
            projectId: "weddyvn",
            storageBucket: "weddyvn.firebasestorage.app",
            messagingSenderId: "504927899297",
            appId: "1:504927899297:web:1a3d3a1b6cfafe0716aae0",
            measurementId: "G-KK4B3RXVNV"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            window.firebaseServices = { auth, db, signInWithEmailAndPassword, onAuthStateChanged, doc, setDoc, updateDoc, onSnapshot, getDoc, collection, GoogleAuthProvider, signInWithPopup, signOut, createUserWithEmailAndPassword };
        } catch (e) { console.error("Firebase Error:", e); }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const APP_ID = 'weddy-stable-final';
        
        // --- UTILS & ICONS ---
        const utils = {
            formatMoney: (a) => {
                if (!a || a === 0) return "0 VNƒê";
                return a >= 1000000000 ? (a/1000000000).toLocaleString('vi-VN', { maximumFractionDigits: 2 }) + " T·ª∑ VNƒê" : (a/1000000).toLocaleString('vi-VN', { maximumFractionDigits: 2 }) + " Tri·ªáu VNƒê";
            },
            formatInput: (v) => v ? v.toString().replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ".") : "",
            parseInput: (v) => v ? parseInt(v.toString().replace(/\./g, '')) || 0 : 0,
            getDaysLeft: (d) => {
                if (!d || d === "Ch∆∞a ƒë·∫∑t") return "---";
                const diff = Math.ceil((new Date(d).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24));
                return diff > 0 ? `${diff} NG√ÄY N·ªÆA` : (diff === 0 ? "H√îM NAY" : "ƒê√É QUA");
            },
            genInvite: () => Math.floor(100000 + Math.random() * 900000).toString()
        };

        const Icon = ({ children, size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );

        const Icons = {
            Heart: (p) => <Icon {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></Icon>,
            Check: (p) => <Icon {...p}><polyline points="20 6 9 17 4 12" /></Icon>,
            Users: (p) => <Icon {...p}><g><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></g></Icon>,
            Plus: (p) => <Icon {...p}><path d="M5 12h14" /><path d="M12 5v14" /></Icon>,
            Layout: (p) => <Icon {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><path d="M3 9h18" /><path d="M9 21V9" /></Icon>,
            DollarSign: (p) => <Icon {...p}><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></Icon>,
            X: (p) => <Icon {...p}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></Icon>,
            ChevronRight: (p) => <Icon {...p}><path d="m9 18 6-6-6-6" /></Icon>,
            Link: (p) => <Icon {...p}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></Icon>,
            Share: (p) => <Icon {...p}><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" x2="15.42" y1="13.51" y2="17.49" /><line x1="15.41" x2="8.59" y1="6.51" y2="10.49" /></Icon>,
            Trash: (p) => <Icon {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></Icon>,
            Bell: (p) => <Icon {...p}><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" /></Icon>,
            Edit: (p) => <Icon {...p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" /></Icon>,
            ArrowUpRight: (p) => <Icon {...p}><path d="M7 7h10v10" /><path d="M7 17 17 7" /></Icon>,
            Star: (p) => <Icon {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></Icon>,
            Home: (p) => <Icon {...p}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></Icon>,
            LogOut: (p) => <Icon {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" x2="9" y1="12" y2="12" /></Icon>,
            Undo: (p) => <Icon {...p}><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></Icon>,
            User: (p) => <Icon {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></Icon>
        };

        const useFirebase = () => {
            const [services, setServices] = useState(null);
            useEffect(() => {
                const interval = setInterval(() => { if (window.firebaseServices) { setServices(window.firebaseServices); clearInterval(interval); } }, 100);
                return () => clearInterval(interval);
            }, []);
            return services;
        };

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 animate-in">
                    <div className="absolute inset-0 transition-all" onClick={onClose}></div>
                    <div className="relative bg-white/95 backdrop-blur-xl rounded-[2.5rem] p-6 md:p-8 w-full max-w-md shadow-[0_20px_60px_rgba(0,0,0,0.15)] border border-stone-100 flex flex-col max-h-[90vh] overflow-y-auto hide-scrollbar text-stone-700">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-title font-bold uppercase tracking-widest text-stone-600">{title}</h3>
                            <button onClick={onClose} className="w-10 h-10 flex items-center justify-center rounded-full bg-stone-50 hover:bg-stone-100 transition-colors shrink-0"><Icons.X size={20} /></button>
                        </div>
                        {children}
                    </div>
                </div>
            );
        };

        const Logo = ({ className, animated = false }) => (
            <div className={`flex items-center gap-1.5 group cursor-pointer ${className}`} onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}>
                <span className="text-lg md:text-xl font-black text-stone-700 tracking-tight group-hover:text-rose-500 transition-colors uppercase" style={{ fontFamily: '"Raleway", sans-serif', fontWeight: 900 }}>WEDDY</span>
                <img src="https://www.svgrepo.com/show/247211/wedding-rings-diamond.svg" alt="Wedding Rings" className={`w-3 h-3 md:w-4 md:h-4 object-contain transition-all duration-500 ${animated ? 'animate-professional' : 'grayscale hover:grayscale-0 opacity-80 hover:opacity-100'}`} />
            </div>
        );

        // --- COMPONENTS: WIZARD & PLANNER ---

        const GettingStartedWizard = ({ onComplete, onSkip }) => {
            const [step, setStep] = useState(0);
            const [data, setData] = useState({ role: "", partnerName: "", engagementDate: "", weddingDate: "", location: "", venue: "", preWedding: "", budget: "", vibes: [] });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const handleNext = () => setStep(prev => prev + 1);
            const weddingVibes = [{ id: 'traditional', label: 'Truy·ªÅn th·ªëng', icon: 'üèÆ' }, { id: 'modern', label: 'Hi·ªán ƒë·∫°i', icon: '‚ú®' }, { id: 'luxury', label: 'Sang tr·ªçng', icon: 'üíé' }, { id: 'rustic', label: 'M·ªôc m·∫°c', icon: 'üåø' }, { id: 'vintage', label: 'C·ªï ƒëi·ªÉn', icon: 'üì∑' }, { id: 'minimalist', label: 'T·ªëi gi·∫£n', icon: '‚ö™' }];
            const toggleVibe = (id) => setData(prev => ({ ...prev, vibes: prev.vibes.includes(id) ? prev.vibes.filter(v => v !== id) : [...prev.vibes, id] }));

            const steps = [
                { title: "Ch√†o b·∫°n,", subtitle: "B·∫°n l√† C√¥ D√¢u hay Ch√∫ R·ªÉ, v√† t√™n th√¢n m·∫≠t c·ªßa ng∆∞·ªùi ·∫•y l√† g√¨?", content: (<div className="space-y-6 mt-6"><div className="grid grid-cols-2 gap-4 font-bold">{["C√¥ d√¢u", "Ch√∫ r·ªÉ"].map(r => (<button key={r} onClick={() => setData({ ...data, role: r })} className={`p-6 rounded-[2rem] border transition-all shadow-sm ${data.role === r ? 'border-stone-800 bg-stone-800 text-white shadow-xl scale-105' : 'border-white bg-white hover:border-stone-300'}`}>{r}</button>))}</div><input type="text" value={data.partnerName} onChange={e => setData({ ...data, partnerName: e.target.value })} placeholder="T√™n th√¢n m·∫≠t c·ªßa ng∆∞·ªùi ·∫•y..." className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-5 text-lg font-bold text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm placeholder:text-stone-300 text-center"/></div>) },
                { title: "Gu c·ªßa hai b·∫°n?", subtitle: "H√£y ch·ªçn nh·ªØng phong c√°ch ƒë√°m c∆∞·ªõi m√† b·∫°n y√™u th√≠ch", content: (<div className="grid grid-cols-2 gap-4 mt-6 animate-in">{weddingVibes.map(v => (<button key={v.id} onClick={() => toggleVibe(v.id)} className={`p-4 rounded-[1.5rem] border transition-all flex flex-col items-center gap-2 ${data.vibes.includes(v.id) ? 'border-stone-800 bg-stone-100 text-stone-800 shadow-md ring-1 ring-stone-200' : 'border-white bg-white hover:bg-stone-50 text-stone-400'}`}><span className="text-3xl mb-1">{v.icon}</span><span className="text-xs font-black uppercase tracking-widest">{v.label}</span></button>))}</div>) },
                { title: "Ng√†y l√†nh th√°ng t·ªët", subtitle: "Ch·ªçn ng√†y L·ªÖ ƒÇn H·ªèi v√† L·ªÖ C∆∞·ªõi", content: (<div className="space-y-6 mt-6"><div><label className="block text-xs font-black uppercase tracking-widest text-stone-400 mb-2">L·ªÖ ƒÇn H·ªèi</label><input type="date" value={data.engagementDate} onChange={e => setData({ ...data, engagementDate: e.target.value })} className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-4 text-lg font-bold text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm text-center uppercase tracking-widest"/></div><div><label className="block text-xs font-black uppercase tracking-widest text-stone-400 mb-2">L·ªÖ C∆∞·ªõi</label><input type="date" value={data.weddingDate} onChange={e => setData({ ...data, weddingDate: e.target.value })} className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-4 text-lg font-bold text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm text-center uppercase tracking-widest"/></div></div>) },
                { title: "N∆°i di·ªÖn ra", subtitle: "ƒê√°m c∆∞·ªõi s·∫Ω di·ªÖn ra t·∫°i ƒë√¢u?", content: (<div className="mt-8"><input type="text" value={data.location} onChange={e => setData({ ...data, location: e.target.value })} placeholder="Vd: TP. H·ªì Ch√≠ Minh" className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-5 text-xl font-bold text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm placeholder:text-stone-300 text-center"/></div>) },
                { title: "ƒê·ªãa ƒëi·ªÉm ti·ªác", subtitle: "T√™n nh√† h√†ng/kh√°ch s·∫°n d·ª± ki·∫øn?", content: (<div className="mt-8"><input type="text" value={data.venue} onChange={e => setData({ ...data, venue: e.target.value })} placeholder="Nh·∫≠p t√™n nh√† h√†ng..." className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-5 text-xl font-bold text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm placeholder:text-stone-300 text-center"/></div>) },
                { title: "·∫¢nh c∆∞·ªõi", subtitle: "D·ª± ƒë·ªãnh ch·ª•p Pre-wedding ·ªü ƒë√¢u?", content: (<div className="mt-8"><input type="text" value={data.preWedding} onChange={e => setData({ ...data, preWedding: e.target.value })} placeholder="Vd: Studio, ƒê√† L·∫°t..." className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-5 text-xl font-bold text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm placeholder:text-stone-300 text-center"/></div>) },
                { title: "Ng√¢n s√°ch", subtitle: "Con s·ªë t·ªëi ƒëa b·∫°n mu·ªën chi?", content: (<div className="mt-8"><div className="relative"><input type="text" value={data.budget} onChange={e => setData({ ...data, budget: utils.formatInput(e.target.value) })} placeholder="300.000.000" className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-5 pl-8 pr-20 text-3xl font-black text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm placeholder:text-stone-200 text-center"/><div className="absolute right-8 top-1/2 -translate-y-1/2 text-stone-400 font-bold text-sm uppercase tracking-widest">VNƒê</div></div></div>) }
            ];
            const current = steps[step];
            const handleFinish = async () => { if (isSubmitting) return; setIsSubmitting(true); try { await onComplete({...data, budget: utils.parseInput(data.budget)}); } catch (e) { setIsSubmitting(false); alert("L·ªói, th·ª≠ l·∫°i sau."); } };

            return (
                <div className="fixed inset-0 z-[200] bg-[#F0EBE5]/95 backdrop-blur-xl flex flex-col animate-in overflow-y-auto">
                    <div className="absolute top-6 right-6 z-50"><button onClick={onSkip} className="text-stone-400 font-bold text-xs uppercase tracking-widest hover:text-stone-600 transition-colors px-4 py-2 bg-white/50 rounded-full hover:bg-white">B·ªè qua</button></div>
                    <div className="flex-1 flex flex-col justify-center px-6 max-w-lg mx-auto w-full text-center py-10">
                        <div className="mb-8"><div className="flex justify-center gap-1.5 mb-8">{steps.map((_, i) => (<div key={i} className={`h-1.5 rounded-full transition-all duration-700 ${i <= step ? 'bg-stone-800 w-8' : 'bg-stone-300/50 w-2'}`}></div>))}</div><h2 className="text-3xl md:text-4xl font-title font-bold tracking-tighter text-stone-800 mb-3">{current.title}</h2><p className="text-stone-500 text-base font-medium leading-relaxed">{current.subtitle}</p></div>
                        <div className="min-h-[160px] flex flex-col justify-center mb-8">{current.content}</div>
                        <div className="space-y-4">{step < steps.length - 1 ? (<><button onClick={handleNext} disabled={step === 0 && !data.role} className="w-full py-5 bg-stone-800 text-white rounded-full text-sm font-black uppercase tracking-[0.2em] shadow-xl hover:bg-stone-700 disabled:opacity-30 disabled:cursor-not-allowed transition-all active:scale-95">Ti·∫øp t·ª•c</button><button onClick={handleNext} className="text-stone-400 text-xs font-bold uppercase tracking-widest hover:text-stone-600 transition-colors p-2">B·ªè qua c√¢u n√†y</button></>) : (<button onClick={handleFinish} disabled={isSubmitting} className="w-full py-5 bg-emerald-700 text-white rounded-full text-sm font-black uppercase tracking-[0.2em] shadow-xl hover:bg-emerald-800 disabled:opacity-70 transition-all active:scale-95 flex items-center justify-center gap-3">{isSubmitting ? '...' : 'Ho√†n t·∫•t'}</button>)}</div>
                    </div>
                </div>
            );
        };

        const PlannerOverview = ({ spentAmount, completedTasks, totalTasks, guestCount, budgetLimit, role, activities, onInvite, onEditBudget, onOpenGuests }) => {
            const percentage = Math.min((spentAmount / (budgetLimit || 300000000)) * 100, 100);
            return (
                <div className="max-w-6xl mx-auto space-y-8 animate-in text-stone-700 text-left px-2 md:px-0">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
                        <div className="lg:col-span-2 space-y-6 md:space-y-8">
                            <div className="bg-white/40 backdrop-blur-md p-6 rounded-[2.5rem] border border-stone-200/50 flex flex-col md:flex-row items-center justify-between gap-4 shadow-sm text-stone-800">
                                <div className="flex items-center gap-4"><div className="w-12 h-12 bg-rose-100/50 rounded-full flex items-center justify-center text-rose-500 shrink-0"><Icons.Heart size={24} fill="currentColor"/></div><div><h4 className="font-title font-bold text-lg">V√≠ chung ƒë√¥i m√¨nh</h4><p className="text-sm text-stone-400">K·∫øt n·ªëi v√† ƒë·ªìng b·ªô.</p></div></div>
                                <button onClick={onInvite} className="w-full md:w-auto px-8 py-4 bg-stone-500 text-white rounded-full text-xs font-black uppercase tracking-widest shadow-sm hover:bg-stone-600 transition-all flex items-center justify-center gap-2"><Icons.Share size={16}/> M·ªùi b·∫°n ƒë·ªùi</button>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-white/80 p-6 md:p-10 rounded-[2.5rem] border border-stone-100 shadow-sm flex flex-col justify-between h-48 text-left"><div className="flex justify-between items-start text-left uppercase tracking-widest text-xs font-bold text-stone-400"><span>Ti·∫øn ƒë·ªô</span><div className="w-10 h-10 bg-stone-50/50 rounded-2xl flex items-center justify-center text-stone-300"><Icons.Check size={20}/></div></div><div><div className="flex items-baseline gap-2 mb-3 text-left font-title font-bold text-stone-600 text-4xl md:text-5xl"><span>{completedTasks}</span><span className="text-stone-300 uppercase text-xs">/ {totalTasks} vi·ªác</span></div><div className="w-full h-2 bg-stone-100 rounded-full overflow-hidden"><div className="h-full bg-stone-500 transition-all duration-700" style={{width: `${totalTasks > 0 ? (completedTasks/totalTasks)*100 : 0}%`}}></div></div></div></div>
                                <div onClick={onOpenGuests} className="bg-white/80 p-6 md:p-10 rounded-[2.5rem] border border-stone-100 shadow-sm flex flex-col justify-between h-48 cursor-pointer hover:border-stone-300 transition-all active:scale-[0.98]"><div className="flex justify-between items-start text-left uppercase tracking-widest text-xs font-bold text-stone-400"><span>Kh√°ch m·ªùi</span><div className="w-10 h-10 bg-stone-50/50 rounded-2xl flex items-center justify-center text-stone-400"><Icons.Users size={20}/></div></div><div className="flex items-baseline gap-2 text-stone-700 text-left font-title font-bold text-5xl md:text-6xl"><span>{guestCount}</span><span className="text-stone-300 font-bold uppercase text-xs">Ng∆∞·ªùi</span></div></div>
                            </div>
                            <div className="bg-stone-500 p-6 md:p-12 rounded-[3rem] text-white relative overflow-hidden shadow-xl group"><div className="absolute top-0 right-0 w-80 h-80 bg-stone-400 rounded-full blur-[150px] opacity-20 -translate-y-1/2 translate-x-1/2 group-hover:opacity-40 transition-opacity duration-700"></div><div className="relative z-10 text-left"><h3 className="text-xs font-black uppercase tracking-[0.3em] text-white/70 mb-6 md:mb-8 text-left">T√†i ch√≠nh ({role || 'B·∫°n'})</h3><div className="flex flex-col md:flex-row justify-between gap-6 md:gap-8"><div className="flex-1 text-white text-left"><div className="text-xs uppercase font-black text-white/30 mb-2 text-left">ƒê√£ chi ti√™u</div><div className="text-5xl md:text-7xl font-title font-bold tracking-tighter text-left tabular-nums">{utils.formatMoney(spentAmount)}</div><div className="w-full h-2 bg-white/10 rounded-full overflow-hidden mt-6 mb-4"><div className="h-full bg-white transition-all duration-700" style={{width: `${percentage}%`}}></div></div><div className="flex items-center gap-2 group/budget inline-flex cursor-pointer text-white/80" onClick={onEditBudget}><p className="text-sm font-black uppercase tracking-widest font-bold">Ng√¢n s√°ch: {utils.formatMoney(budgetLimit)}</p><Icons.Edit size={16} className="text-white/20 group-hover/budget:text-white transition-colors" /></div></div><div className="md:w-48 flex flex-col gap-4 justify-center text-white"><div className="bg-white/10 backdrop-blur-sm p-6 rounded-3xl border border-white/5 text-center md:text-left shadow-sm shadow-inner"><p className="text-xs font-black text-white/40 uppercase mb-2 text-left">C√≤n l·∫°i</p><p className="text-2xl font-title font-bold text-left">{utils.formatMoney((budgetLimit || 300000000) - spentAmount)}</p></div></div></div></div></div>
                        </div>
                        <div className="bg-white/60 backdrop-blur-md p-6 md:p-10 rounded-[2.5rem] border border-stone-100 shadow-sm h-full flex flex-col">
                            <h3 className="text-sm font-black uppercase tracking-[0.2em] mb-8 text-stone-700 border-b border-stone-100 pb-6 font-bold text-left uppercase">Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h3>
                            <div className="space-y-6 flex-1 overflow-y-auto hide-scrollbar max-h-[400px] md:max-h-[500px]">{activities?.length > 0 ? activities.map((act, i) => (<div key={i} className="flex gap-4 items-start group animate-in text-left"><div className="w-10 h-10 bg-stone-50 rounded-2xl flex items-center justify-center shrink-0 group-hover:bg-stone-500 group-hover:text-white transition-colors shadow-sm"><Icons.ArrowUpRight size={18} className="text-stone-300 group-hover:text-white" /></div><div className="text-left text-stone-600"><p className="text-sm font-bold leading-snug text-left">{act.text}</p><p className="text-xs font-black text-stone-300 uppercase tracking-widest mt-1 text-left">{act.time}</p></div></div>)) : <p className="text-base text-stone-300 italic font-medium text-center">Ch∆∞a c√≥ th√¥ng b√°o.</p>}</div>
                        </div>
                    </div>
                </div>
            );
        };

        const PlannerBudget = ({ tasks, onAddExpense, onDeleteTask }) => {
            const [isOpen, setIsOpen] = useState(false); const [activeFilter, setActiveFilter] = useState('all');
            const [title, setTitle] = useState(""); const [cost, setCost] = useState(""); const [paid, setPaid] = useState(""); const [category, setCategory] = useState("ƒê·∫∑t ti·ªác c∆∞·ªõi");
            const [confirmDeleteId, setConfirmDeleteId] = useState(null); const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 5; const listRef = useRef(null);
            
            const allBudgetTasks = (tasks || []).filter(t => t.cost > 0);
            const displayTasks = activeFilter === 'groom' ? allBudgetTasks.filter(t => t.paidBy === 'Ch√∫ r·ªÉ') : activeFilter === 'bride' ? allBudgetTasks.filter(t => t.paidBy === 'C√¥ d√¢u') : allBudgetTasks;
            
            useEffect(() => { setCurrentPage(1); }, [activeFilter, tasks]);
            useEffect(() => { if(listRef.current && currentPage > 1) listRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, [currentPage]);

            const totalBudget = displayTasks.reduce((acc, curr) => acc + curr.cost, 0);
            const totalPaid = displayTasks.reduce((acc, curr) => acc + (curr.paid || (curr.status === 'done' ? curr.cost : 0)), 0);
            const totalPages = Math.ceil(displayTasks.length / itemsPerPage);
            const currentTransactions = displayTasks.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);
            
            const handleSave = () => { if (title.trim() && cost) { onAddExpense({ title: title.trim(), tag: category, status: utils.parseInput(paid) >= utils.parseInput(cost) ? 'done' : 'pending', cost: utils.parseInput(cost), paid: utils.parseInput(paid), id: Date.now() }); setTitle(""); setCost(""); setPaid(""); setIsOpen(false); setCurrentPage(1); } };
            
            return (
                <div className="max-w-6xl mx-auto space-y-8 animate-in text-stone-700 px-2 md:px-0">
                    <div className="flex justify-center"><div className="bg-stone-100 p-1.5 rounded-full flex gap-1">{[{ id: 'all', label: 'V√≠ chung' }, { id: 'groom', label: 'Ch√∫ r·ªÉ' }, { id: 'bride', label: 'C√¥ d√¢u' }].map(f => (<button key={f.id} onClick={() => setActiveFilter(f.id)} className={`px-4 md:px-8 py-3 rounded-full text-xs font-black uppercase tracking-widest transition-all ${activeFilter === f.id ? 'bg-white shadow-md text-stone-800' : 'text-stone-400 hover:text-stone-600'}`}>{f.label}</button>))}</div></div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6"><div className="bg-white p-8 rounded-[2.5rem] border border-stone-100 shadow-sm flex flex-col justify-between h-48"><div className="flex justify-between items-start"><p className="text-xs font-black uppercase tracking-[0.2em] text-stone-400">D·ª± ki·∫øn chi</p><div className="p-3 bg-stone-50 rounded-full text-stone-400"><Icons.DollarSign size={20}/></div></div><p className="text-3xl font-title font-bold text-stone-800 tracking-tighter">{utils.formatMoney(totalBudget)}</p></div><div className="bg-stone-800 p-8 rounded-[2.5rem] shadow-xl flex flex-col justify-between h-48 text-white"><div className="flex justify-between items-start"><p className="text-xs font-black uppercase tracking-[0.2em] text-white/50">ƒê√£ thanh to√°n</p><div className="p-3 bg-white/10 rounded-full text-white"><Icons.Check size={20}/></div></div><p className="text-3xl font-title font-bold tracking-tighter">{utils.formatMoney(totalPaid)}</p></div><div className="bg-white p-8 rounded-[2.5rem] border border-stone-100 shadow-sm flex flex-col justify-between h-48"><div className="flex justify-between items-start"><p className="text-xs font-black uppercase tracking-[0.2em] text-stone-400">C√≤n l·∫°i</p><div className="p-3 bg-stone-50 rounded-full text-stone-400"><Icons.Layout size={20}/></div></div><p className={`text-3xl font-title font-bold tracking-tighter ${totalBudget - totalPaid < 0 ? 'text-rose-500' : 'text-stone-800'}`}>{utils.formatMoney(totalBudget - totalPaid)}</p></div></div>
                    <div className="flex flex-col md:flex-row justify-between items-end md:items-center gap-4"><div className="text-left"><h3 className="text-3xl font-title font-bold text-stone-700 uppercase tracking-tighter">Chi ti·∫øt kho·∫£n chi</h3></div><button onClick={() => setIsOpen(true)} className="group w-full md:w-auto flex items-center justify-center gap-3 px-8 py-4 bg-stone-200 text-stone-600 hover:bg-stone-300 rounded-full text-xs font-black uppercase tracking-widest transition-all active:scale-95 shadow-sm"><Icons.Plus size={16}/> Th√™m kho·∫£n chi</button></div>
                    <div className="space-y-4 animate-in" key={currentPage} ref={listRef}>{displayTasks.length === 0 ? <div className="py-24 text-center border-2 border-dashed border-stone-200 rounded-[2.5rem]"><p className="text-stone-400 text-sm font-bold uppercase tracking-widest">Ch∆∞a c√≥ d·ªØ li·ªáu</p></div> : currentTransactions.map((item) => (<div key={item.id} className="group p-6 bg-white rounded-[2rem] border border-stone-100 hover:border-stone-300 transition-all flex flex-col md:flex-row md:items-center justify-between gap-4 relative"><div className="flex items-center gap-5"><div className={`w-14 h-14 rounded-2xl flex items-center justify-center shrink-0 shadow-inner ${(item.paid || 0) >= item.cost ? 'bg-emerald-50 text-emerald-600' : 'bg-stone-50 text-stone-400'}`}><Icons.DollarSign size={24} /></div><div className="text-left"><h4 className="font-bold text-lg text-stone-700 leading-tight uppercase">{item.title}</h4><div className="flex gap-2 mt-2"><span className="inline-block text-[10px] font-black uppercase tracking-wider text-stone-400 bg-stone-50 px-3 py-1 rounded-lg border border-stone-100">{item.tag}</span>{item.paidBy && <span className={`inline-block text-[10px] font-black uppercase tracking-wider px-3 py-1 rounded-lg border border-transparent ${item.paidBy === 'Ch√∫ r·ªÉ' ? 'bg-blue-50 text-blue-500' : 'bg-rose-50 text-rose-500'}`}>{item.paidBy}</span>}</div></div></div><div className="flex flex-col items-end gap-1"><p className="font-bold text-xl text-stone-800 tracking-tight">{utils.formatMoney(item.cost)}</p><div className="flex items-center gap-2">{(item.paid || 0) >= item.cost ? <span className="text-[10px] font-black uppercase tracking-widest text-emerald-600 bg-emerald-50 px-3 py-1.5 rounded-lg">ƒê√£ xong</span> : <span className="text-[10px] font-black uppercase tracking-widest text-stone-400 bg-stone-50 px-3 py-1.5 rounded-lg">ƒê√£ tr·∫£: {utils.formatMoney(item.paid || 0)}</span>}</div></div><button onClick={(e) => { e.stopPropagation(); setConfirmDeleteId(item.id); }} className="w-10 h-10 flex items-center justify-center rounded-full text-stone-300 hover:bg-rose-50 hover:text-rose-500 transition-all opacity-100 md:opacity-0 group-hover:opacity-100 absolute top-4 right-4 md:relative md:top-0 md:right-0"><Icons.Trash size={20} /></button></div>))}</div>
                    {totalPages > 1 && (<div className="flex justify-center items-center gap-4 pt-6 pb-4"><button onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))} disabled={currentPage === 1} className="w-10 h-10 rounded-full flex items-center justify-center bg-white border border-stone-200 text-stone-500 hover:bg-stone-50 disabled:opacity-30 disabled:cursor-not-allowed transition-all shadow-sm"><Icons.ChevronRight size={16} className="rotate-180" /></button><span className="text-xs font-black uppercase tracking-widest text-stone-400">Trang {currentPage} / {totalPages}</span><button onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))} disabled={currentPage === totalPages} className="w-10 h-10 rounded-full flex items-center justify-center bg-white border border-stone-200 text-stone-500 hover:bg-stone-50 disabled:opacity-30 disabled:cursor-not-allowed transition-all shadow-sm"><Icons.ChevronRight size={16} /></button></div>)}
                    <Modal isOpen={isOpen} onClose={() => setIsOpen(false)} title="Th√™m kho·∫£n chi"><div className="space-y-6 pt-2"><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">T√™n kho·∫£n chi</label><input type="text" value={title} onChange={e=>setTitle(e.target.value)} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-base font-bold uppercase shadow-inner" placeholder="VD: CH·ª§P ·∫¢NH C∆Ø·ªöI" autoFocus /></div><div className="grid grid-cols-1 sm:grid-cols-2 gap-6"><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">H·∫°ng m·ª•c</label><div className="relative"><select value={category} onChange={e=>setCategory(e.target.value)} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl text-base font-bold uppercase appearance-none focus:outline-none focus:border-stone-400 focus:bg-white transition-all shadow-inner"><option value="ƒê·∫∑t ti·ªác c∆∞·ªõi">Ti·ªác c∆∞·ªõi</option><option value="Ch·ª•p ·∫£nh">Ch·ª•p ·∫£nh</option><option value="Trang ph·ª•c">Trang ph·ª•c</option><option value="Kh√°c">Kh√°c</option></select><div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-stone-400"><Icons.ChevronRight size={16} className="rotate-90" /></div></div></div><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">S·ªë ti·ªÅn (VNƒê)</label><input type="text" value={cost} onChange={e=>setCost(utils.formatInput(e.target.value))} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-base font-bold shadow-inner" placeholder="0" /></div></div><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">ƒê√£ tr·∫£ tr∆∞·ªõc (VNƒê)</label><input type="text" value={paid} onChange={e=>setPaid(utils.formatInput(e.target.value))} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-base font-bold shadow-inner" placeholder="0" /></div><div className="pt-8 border-t border-stone-50"><button onClick={handleSave} className="w-full py-5 bg-stone-800 text-white rounded-full font-black uppercase text-sm tracking-[0.2em] shadow-xl hover:bg-stone-700 active:scale-95 transition-all flex items-center justify-center gap-3"><Icons.Plus size={16} strokeWidth={3}/> L∆∞u l·∫°i</button></div></div></Modal>
                    <Modal isOpen={confirmDeleteId !== null} onClose={() => setConfirmDeleteId(null)} title="X√°c nh·∫≠n xo√°"><div className="text-center space-y-6 pt-4"><div className="w-16 h-16 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-2 text-rose-500"><Icons.Trash size={28} /></div><p className="text-stone-500 text-base font-medium">X√≥a kho·∫£n chi n√†y?</p><div className="flex gap-4 justify-center"><button onClick={() => setConfirmDeleteId(null)} className="px-8 py-4 bg-stone-100 text-stone-600 rounded-full font-black text-xs uppercase tracking-widest hover:bg-stone-200 transition-all">H·ªßy</button><button onClick={() => { onDeleteTask(confirmDeleteId); setConfirmDeleteId(null); }} className="px-8 py-4 bg-rose-500 text-white rounded-full font-black text-xs uppercase tracking-widest hover:bg-rose-600 transition-all shadow-lg shadow-rose-200">X√≥a lu√¥n</button></div></div></Modal>
                </div>
            );
        };

        const PlannerTasks = ({ tasks, onAddTask, onToggleTask, onDeleteTask }) => {
            const [isOpen, setIsOpen] = useState(false); const [title, setTitle] = useState(""); const [cat, setCat] = useState("ƒê·∫∑t ti·ªác c∆∞·ªõi"); const [cost, setCost] = useState("");
            const [confirmDeleteId, setConfirmDeleteId] = useState(null); const [pendingPage, setPendingPage] = useState(1); const [donePage, setDonePage] = useState(1);
            const pendingPerPage = 5; const donePerPage = 3; const pendingListRef = useRef(null); const doneListRef = useRef(null);
            const handleAdd = () => { if (title.trim()) { onAddTask({ title: title.trim(), tag: cat, status: "pending", cost: utils.parseInput(cost), paid: 0, id: Date.now() }); setTitle(""); setCost(""); setIsOpen(false); setPendingPage(1); } };
            const pending = tasks?.filter(t => t.status !== 'done') || []; const done = tasks?.filter(t => t.status === 'done') || [];
            const totalPendingPages = Math.ceil(pending.length / pendingPerPage) || 1; const currentPending = pending.slice((pendingPage - 1) * pendingPerPage, pendingPage * pendingPerPage);
            const totalDonePages = Math.ceil(done.length / donePerPage) || 1; const currentDone = done.slice((donePage - 1) * donePerPage, donePage * donePerPage);
            useEffect(() => { if (pendingPage > totalPendingPages) setPendingPage(totalPendingPages); }, [pending.length]);
            useEffect(() => { if (donePage > totalDonePages) setDonePage(totalDonePages); }, [done.length]);

            return (
                <div className="max-w-6xl mx-auto space-y-8 animate-in text-stone-700 text-left px-2 md:px-0">
                    <div className="flex flex-col md:flex-row justify-between items-end md:items-center gap-4"><div className="text-left"><h3 className="text-3xl font-title font-bold text-stone-700 uppercase tracking-tighter">Danh s√°ch c√¥ng vi·ªác</h3><p className="text-xs font-bold text-stone-400 uppercase tracking-widest mt-1">{pending.length} vi·ªác c·∫ßn l√†m</p></div><button onClick={() => setIsOpen(true)} className="group w-full md:w-auto flex items-center justify-center gap-3 px-8 py-4 bg-stone-800 text-white rounded-full text-xs font-black uppercase tracking-widest hover:bg-stone-700 transition-all active:scale-95 shadow-xl hover:shadow-2xl"><span className="w-5 h-5 rounded-full bg-white/20 flex items-center justify-center group-hover:bg-white/30 transition-colors"><Icons.Plus size={12} /></span> Th√™m vi·ªác m·ªõi</button></div>
                    <div className="space-y-4 animate-in" key={pendingPage} ref={pendingListRef}>{pending.length > 0 ? currentPending.map((t) => (<div key={t.id || t.title} onClick={() => onToggleTask(t.id)} className="group p-6 bg-white rounded-[2rem] border border-stone-100 hover:border-stone-300 hover:shadow-lg transition-all cursor-pointer flex items-center gap-6 relative"><div className="w-8 h-8 rounded-xl border-2 border-stone-200 group-hover:border-stone-400 group-hover:bg-stone-50 transition-all shrink-0"></div><div className="flex-1"><h4 className="font-bold text-stone-800 text-lg leading-tight uppercase">{t.title}</h4><span className="inline-block mt-2 text-[10px] font-black uppercase tracking-wider text-stone-400">{t.tag}</span></div><button onClick={(e) => { e.stopPropagation(); setConfirmDeleteId(t.id); }} className="w-10 h-10 flex items-center justify-center rounded-full text-stone-300 hover:bg-rose-50 hover:text-rose-500 transition-all opacity-100 md:opacity-0 group-hover:opacity-100 absolute top-4 right-4 md:relative md:top-0 md:right-0"><Icons.Trash size={20} /></button></div>)) : <div className="py-24 text-center border-2 border-dashed border-stone-200 rounded-[2.5rem] bg-white/50"><p className="text-stone-400 font-bold uppercase text-sm tracking-widest">M·ªçi vi·ªác ƒë√£ ho√†n t·∫•t! ‚ú®</p></div>}</div>
                    {totalPendingPages > 1 && (<div className="flex justify-center items-center gap-4 pt-2"><button onClick={() => setPendingPage(prev => Math.max(prev - 1, 1))} disabled={pendingPage === 1} className="w-10 h-10 rounded-full flex items-center justify-center bg-white border border-stone-200 text-stone-500 hover:bg-stone-50 disabled:opacity-30 transition-all shadow-sm"><Icons.ChevronRight size={16} className="rotate-180" /></button><span className="text-xs font-black uppercase tracking-widest text-stone-400">Trang {pendingPage} / {totalPendingPages}</span><button onClick={() => setPendingPage(prev => Math.min(prev + 1, totalPendingPages))} disabled={pendingPage === totalPendingPages} className="w-10 h-10 rounded-full flex items-center justify-center bg-white border border-stone-200 text-stone-500 hover:bg-stone-50 disabled:opacity-30 transition-all shadow-sm"><Icons.ChevronRight size={16} /></button></div>)}
                    {done.length > 0 && (<div className="pt-10 opacity-60 hover:opacity-100 transition-opacity duration-300" ref={doneListRef}><h4 className="mb-6 text-xs font-black uppercase tracking-widest text-stone-400">ƒê√£ ho√†n th√†nh ({done.length})</h4><div className="space-y-3 animate-in" key={donePage}>{currentDone.map((t) => (<div key={t.id || t.title} className="p-5 bg-stone-50 rounded-[1.5rem] border border-stone-100 flex items-center justify-between gap-4 text-stone-400 transition-colors"><div className="flex items-center gap-5 cursor-pointer flex-1" onClick={() => onToggleTask(t.id)}><div className="w-8 h-8 rounded-xl bg-stone-300 flex items-center justify-center text-white shrink-0"><Icons.Check size={16} /></div><h4 className="text-base font-bold line-through uppercase">{t.title}</h4></div><button onClick={() => onToggleTask(t.id)} className="group/undo flex items-center gap-2 px-4 py-2 bg-white border border-stone-100 rounded-full shadow-sm hover:bg-stone-100 hover:border-stone-300 transition-all shrink-0" title="Ho√†n t√°c"><Icons.Undo size={14} className="text-stone-400 group-hover/undo:text-stone-600" /><span className="text-[10px] font-black uppercase tracking-widest text-stone-400 group-hover/undo:text-stone-600 hidden sm:inline">Ho√†n t√°c</span></button></div>))}</div>{totalDonePages > 1 && (<div className="flex justify-center items-center gap-4 pt-4"><button onClick={() => setDonePage(prev => Math.max(prev - 1, 1))} disabled={donePage === 1} className="w-10 h-10 rounded-full flex items-center justify-center bg-white border border-stone-200 text-stone-500 hover:bg-stone-50 disabled:opacity-30 transition-all shadow-sm"><Icons.ChevronRight size={16} className="rotate-180" /></button><span className="text-xs font-black uppercase tracking-widest text-stone-400">Trang {donePage} / {totalDonePages}</span><button onClick={() => setDonePage(prev => Math.min(prev + 1, totalDonePages))} disabled={donePage === totalDonePages} className="w-10 h-10 rounded-full flex items-center justify-center bg-white border border-stone-200 text-stone-500 hover:bg-stone-50 disabled:opacity-30 transition-all shadow-sm"><Icons.ChevronRight size={16} /></button></div>)}</div>)}
                    <Modal isOpen={isOpen} onClose={() => setIsOpen(false)} title="C√¥ng vi·ªác m·ªõi"><div className="space-y-6 pt-2"><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">T√™n c√¥ng vi·ªác</label><input type="text" value={title} onChange={e=>setTitle(e.target.value)} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-base font-bold shadow-inner uppercase" placeholder="VD: ƒê·∫∂T HOA C∆Ø·ªöI" autoFocus /></div><div className="grid grid-cols-2 gap-6"><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Ph√¢n lo·∫°i</label><div className="relative"><select value={cat} onChange={e=>setCat(e.target.value)} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl text-base font-bold uppercase appearance-none focus:outline-none focus:border-stone-400 focus:bg-white transition-all shadow-inner"><option value="ƒê·∫∑t ti·ªác c∆∞·ªõi">Ti·ªác c∆∞·ªõi</option><option value="Ch·ª•p ·∫£nh">Ch·ª•p ·∫£nh</option><option value="Trang ph·ª•c">Trang ph·ª•c</option><option value="Kh√°c">Kh√°c</option></select><div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-stone-400"><Icons.ChevronRight size={16} className="rotate-90" /></div></div></div><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">D·ª± chi (VNƒê)</label><input type="text" value={cost} onChange={e=>setCost(utils.formatInput(e.target.value))} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-base font-bold shadow-inner" placeholder="0" /></div></div><div className="pt-8 border-t border-stone-50"><button onClick={handleAdd} className="w-full py-5 bg-stone-800 text-white rounded-full font-black uppercase text-sm tracking-[0.2em] shadow-xl hover:bg-stone-700 active:scale-95 transition-all flex items-center justify-center gap-3"><Icons.Plus size={16} strokeWidth={3}/> L∆∞u l·∫°i</button></div></div></Modal>
                    <Modal isOpen={confirmDeleteId !== null} onClose={() => setConfirmDeleteId(null)} title="X√°c nh·∫≠n xo√°"><div className="text-center space-y-6 pt-4"><div className="w-16 h-16 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-2 text-rose-500"><Icons.Trash size={28} /></div><p className="text-stone-500 text-base font-medium">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√¥ng vi·ªác n√†y kh√¥ng?<br/>H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p><div className="flex gap-4 justify-center"><button onClick={() => setConfirmDeleteId(null)} className="px-8 py-4 bg-stone-100 text-stone-600 rounded-full font-black text-xs uppercase tracking-widest hover:bg-stone-200 transition-all">H·ªßy</button><button onClick={() => { onDeleteTask(confirmDeleteId); setConfirmDeleteId(null); }} className="px-8 py-4 bg-rose-500 text-white rounded-full font-black text-xs uppercase tracking-widest hover:bg-rose-600 transition-all shadow-lg shadow-rose-200">X√≥a lu√¥n</button></div></div></Modal>
                </div>
            );
        };

        const PlannerGuests = ({ guests, onAddGuest, onDeleteGuest }) => {
            const [isOpen, setIsOpen] = useState(false); const [name, setName] = useState(""); const [rel, setRel] = useState("B·∫°n b√®"); const [phone, setPhone] = useState("");
            const [confirmDeleteId, setConfirmDeleteId] = useState(null); const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 10; const listRef = useRef(null);
            useEffect(() => { const maxPage = Math.ceil((guests?.length || 0) / itemsPerPage) || 1; if (currentPage > maxPage) setCurrentPage(maxPage); }, [guests?.length]);
            useEffect(() => { if(listRef.current && currentPage > 1) listRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, [currentPage]);
            const handleAdd = () => { if (name.trim()) { onAddGuest({ name: name.trim(), relationship: rel, phone, id: Date.now() }); setName(""); setPhone(""); setIsOpen(false); setCurrentPage(1); } };
            const indexOfLastItem = currentPage * itemsPerPage; const indexOfFirstItem = indexOfLastItem - itemsPerPage;
            const currentGuests = guests?.slice(indexOfFirstItem, indexOfLastItem); const totalPages = Math.ceil((guests?.length || 0) / itemsPerPage);
            const relationshipColors = { "B·∫°n b√®": "bg-blue-50 text-blue-600", "Gia ƒë√¨nh": "bg-rose-50 text-rose-600", "ƒê·ªìng nghi·ªáp": "bg-purple-50 text-purple-600", "Kh√°c": "bg-stone-50 text-stone-600" };

            return (
                <div className="max-w-6xl mx-auto space-y-8 animate-in px-2 md:px-0">
                    <div className="flex flex-col md:flex-row justify-between items-end md:items-center gap-4"><div className="text-left w-full md:w-auto"><h3 className="text-3xl font-title font-bold text-stone-700 uppercase tracking-tighter">Danh s√°ch kh√°ch m·ªùi</h3><p className="text-xs font-bold text-stone-400 uppercase tracking-widest mt-1">T·ªïng c·ªông: <span className="text-stone-700">{guests?.length || 0}</span> ng∆∞·ªùi</p></div><button onClick={() => setIsOpen(true)} className="group w-full md:w-auto flex items-center justify-center gap-3 px-8 py-4 bg-stone-800 text-white rounded-full text-xs font-black uppercase tracking-widest hover:bg-stone-700 transition-all active:scale-95 shadow-xl hover:shadow-2xl"><span className="w-5 h-5 rounded-full bg-white/20 flex items-center justify-center group-hover:bg-white/30 transition-colors"><Icons.Plus size={12} /></span> Th√™m kh√°ch m·ªõi</button></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 animate-in" key={currentPage} ref={listRef}>{guests?.length === 0 ? <div className="col-span-full py-24 text-center border-2 border-dashed border-stone-200 rounded-[2.5rem] bg-white/50"><div className="w-20 h-20 bg-stone-100 rounded-full flex items-center justify-center mx-auto mb-6 text-stone-400 shadow-inner"><Icons.Users size={32} /></div><p className="text-stone-400 font-bold uppercase text-xs tracking-widest">Danh s√°ch tr·ªëng</p><button onClick={() => setIsOpen(true)} className="mt-3 text-sm font-black underline uppercase text-stone-600 hover:text-stone-900 transition-colors">Th√™m kh√°ch ƒë·∫ßu ti√™n</button></div> : currentGuests?.map((g) => (<div key={g.id} className="group bg-white p-6 rounded-[2rem] border border-stone-100 hover:border-stone-300 hover:shadow-lg transition-all flex items-center justify-between cursor-default relative"><div className="flex items-center gap-5"><div className={`w-14 h-14 rounded-2xl flex items-center justify-center text-lg font-black uppercase shadow-inner shrink-0 ${relationshipColors[g.relationship] || 'bg-stone-100 text-stone-500'}`}>{g.name.charAt(0)}</div><div className="text-left"><h4 className="font-bold text-stone-700 text-lg leading-tight uppercase">{g.name}</h4><div className="flex items-center gap-2 mt-2 flex-wrap"><span className="text-[10px] font-black uppercase tracking-wider text-stone-400 border border-stone-100 px-3 py-1 rounded-lg bg-stone-50">{g.relationship}</span>{g.phone && <span className="text-[11px] font-bold text-stone-400 tabular-nums tracking-wide">{g.phone}</span>}</div></div></div><button onClick={() => setConfirmDeleteId(g.id)} className="w-10 h-10 flex items-center justify-center rounded-full text-stone-300 hover:bg-rose-50 hover:text-rose-500 transition-all opacity-100 md:opacity-0 group-hover:opacity-100 absolute top-4 right-4 md:relative md:top-0 md:right-0"><Icons.Trash size={20} /></button></div>))}</div>
                    {totalPages > 1 && (<div className="flex justify-center items-center gap-4 pt-6 pb-4"><button onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))} disabled={currentPage === 1} className="w-10 h-10 rounded-full flex items-center justify-center bg-white border border-stone-200 text-stone-500 hover:bg-stone-50 disabled:opacity-30 disabled:cursor-not-allowed transition-all shadow-sm"><Icons.ChevronRight size={16} className="rotate-180" /></button><span className="text-xs font-black uppercase tracking-widest text-stone-400">Trang {currentPage} / {totalPages}</span><button onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))} disabled={currentPage === totalPages} className="w-10 h-10 rounded-full flex items-center justify-center bg-white border border-stone-200 text-stone-500 hover:bg-stone-50 disabled:opacity-30 disabled:cursor-not-allowed transition-all shadow-sm"><Icons.ChevronRight size={16} /></button></div>)}
                    <Modal isOpen={isOpen} onClose={() => setIsOpen(false)} title="Th√™m kh√°ch m·ªùi"><div className="space-y-6 pt-2"><div className="space-y-5 text-left"><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">H·ªç v√† t√™n</label><input type="text" value={name} onChange={e => setName(e.target.value)} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-base font-bold text-stone-700 placeholder:text-stone-300 uppercase" placeholder="NH·∫¨P T√äN KH√ÅCH M·ªúI..." autoFocus /></div><div className="grid grid-cols-1 sm:grid-cols-2 gap-6"><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">M·ªëi quan h·ªá</label><div className="relative"><select value={rel} onChange={e => setRel(e.target.value)} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl appearance-none font-bold text-base text-stone-700 focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all uppercase"><option value="B·∫°n b√®">B·∫°n b√®</option><option value="Gia ƒë√¨nh">Gia ƒë√¨nh</option><option value="ƒê·ªìng nghi·ªáp">ƒê·ªìng nghi·ªáp</option><option value="Kh√°c">Kh√°c</option></select><div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-stone-400"><Icons.ChevronRight size={16} className="rotate-90" /></div></div></div><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">S·ªë ƒëi·ªán tho·∫°i</label><input type="text" value={phone} onChange={e => setPhone(utils.formatInput(e.target.value))} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-base font-bold text-stone-700 placeholder:text-stone-300 tabular-nums tracking-wider" placeholder="09..." /></div></div></div><div className="pt-8 border-t border-stone-50"><button onClick={handleAdd} className="w-full py-5 bg-stone-800 text-white rounded-full font-black uppercase text-sm tracking-[0.2em] shadow-xl hover:bg-stone-700 active:scale-95 transition-all flex items-center justify-center gap-3"><Icons.Plus size={16} strokeWidth={3} /> L∆∞u kh√°ch m·ªùi</button></div></div></Modal>
                    <Modal isOpen={confirmDeleteId !== null} onClose={() => setConfirmDeleteId(null)} title="X√°c nh·∫≠n xo√°"><div className="text-center space-y-6 pt-4"><div className="w-16 h-16 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-2 text-rose-500"><Icons.Trash size={28} /></div><p className="text-stone-500 text-base font-medium">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√°ch m·ªùi n√†y kh√¥ng?<br/>H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p><div className="flex gap-4 justify-center"><button onClick={() => setConfirmDeleteId(null)} className="px-8 py-4 bg-stone-100 text-stone-600 rounded-full font-black text-xs uppercase tracking-widest hover:bg-stone-200 transition-all">H·ªßy</button><button onClick={() => { onDeleteGuest(confirmDeleteId); setConfirmDeleteId(null); }} className="px-8 py-4 bg-rose-500 text-white rounded-full font-black text-xs uppercase tracking-widest hover:bg-rose-600 transition-all shadow-lg shadow-rose-200">X√≥a lu√¥n</button></div></div></Modal>
                </div>
            );
        };

        const MobileNav = ({ activeTab, onNavigate }) => (
            <div className="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-xl border-t border-stone-200 p-3 md:hidden z-50 pb-safe">
                <div className="flex justify-around items-center">
                    {[{id: 'home', icon: Icons.Home, label: 'Home'}, {id: 'planner', icon: Icons.Layout, label: 'Planner'}, {id: 'invitation', icon: Icons.Link, label: 'Thi·ªáp'}, {id: 'vendors', icon: Icons.Star, label: 'D·ªãch v·ª•'}, {id: 'account', icon: Icons.User, label: 'T√†i kho·∫£n'}].map(item => (
                        <button key={item.id} onClick={() => onNavigate(item.id)} className={`flex flex-col items-center gap-1 p-2 rounded-xl transition-all ${activeTab === item.id ? 'text-stone-800 bg-stone-100' : 'text-stone-400'}`}>
                            <item.icon size={24} fill={activeTab === item.id ? "currentColor" : "none"} strokeWidth={activeTab === item.id ? 2.5 : 2} />
                            <span className="text-[10px] font-black uppercase tracking-wider">{item.label}</span>
                        </button>
                    ))}
                </div>
            </div>
        );

        const Footer = () => (
            <footer className="bg-white/60 backdrop-blur-md border-t border-stone-100 py-12 mt-16 mb-24 md:mb-0">
                <div className="max-w-6xl mx-auto px-6">
                    <div className="flex flex-col md:flex-row justify-between items-center md:items-start gap-8">
                        <div className="text-center md:text-left flex flex-col items-center md:items-start"><div className="mb-3"><Logo /></div><p className="text-stone-500 text-sm max-w-xs font-medium leading-relaxed">N·ªÅn t·∫£ng l·∫≠p k·∫ø ho·∫°ch ƒë√°m c∆∞·ªõi tinh t·∫ø, gi√∫p b·∫°n v√† ng∆∞·ªùi ·∫•y ƒë·ªìng h√†nh tr√™n h√†nh tr√¨nh h·∫°nh ph√∫c.</p></div>
                        <div className="flex flex-col items-center md:items-end gap-6"><div className="flex flex-wrap justify-center md:justify-end gap-6 md:gap-8">{['V·ªÅ ch√∫ng t√¥i', 'ƒêi·ªÅu kho·∫£n', 'Ri√™ng t∆∞', 'Li√™n h·ªá'].map(item => (<a key={item} href="#" className="text-sm font-bold tracking-wide text-stone-500 hover:text-stone-800 transition-colors">{item}</a>))}</div><div className="text-[10px] font-bold text-stone-300 uppercase tracking-widest">¬© 2024 Weddy. All rights reserved.</div></div>
                    </div>
                </div>
            </footer>
        );

        // --- AI ENGINE & MOCK DATA ---
        const MOCK_VENDORS = [
            { id: 1, name: "TuArt Wedding", category: "photography", location: "Hanoi", price: 15000000, tags: ['modern', 'luxury', 'korean'], image: "https://images.unsplash.com/photo-1537633552985-df8429e8048b?auto=format&fit=crop&q=80&w=500" },
            { id: 2, name: "Gem Center", category: "venue", location: "HCM", price: 200000000, tags: ['luxury', 'modern'], image: "https://images.unsplash.com/photo-1519167758481-83f550bb49b3?auto=format&fit=crop&q=80&w=500" },
            { id: 3, name: "M·ªôc Studio", category: "photography", location: "HCM", price: 8000000, tags: ['rustic', 'vintage', 'minimalist'], image: "https://images.unsplash.com/photo-1520854221256-17451cc330e7?auto=format&fit=crop&q=80&w=500" },
            { id: 4, name: "Tr·ªëng ƒê·ªìng Palace", category: "venue", location: "Hanoi", price: 80000000, tags: ['traditional', 'modern'], image: "https://images.unsplash.com/photo-1519741497674-611481863552?auto=format&fit=crop&q=80&w=500" },
            { id: 5, name: "H√† N·ªôi Wedding Planner", category: "planner", location: "Hanoi", price: 30000000, tags: ['traditional', 'luxury'], image: "https://images.unsplash.com/photo-1515934751635-c81c6bc9a2d8?auto=format&fit=crop&q=80&w=500" },
            { id: 6, name: "Nupakachi", category: "photography", location: "HCM", price: 25000000, tags: ['luxury', 'modern'], image: "https://images.unsplash.com/photo-1606800052052-a08af7148866?auto=format&fit=crop&q=80&w=500" },
            { id: 7, name: "Chill Decor", category: "decoration", location: "Danang", price: 12000000, tags: ['rustic', 'minimalist'], image: "https://images.unsplash.com/photo-1478146059778-26028b07395a?auto=format&fit=crop&q=80&w=500" },
            { id: 8, name: "White Dress", category: "makeup", location: "Hanoi", price: 5000000, tags: ['korean', 'modern'], image: "https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?auto=format&fit=crop&q=80&w=500" },
        ];

        const getRecommendations = (userProfile, vendors) => {
            if (!userProfile) return vendors;
            const userLocation = userProfile.location || "";
            const userBudget = parseInt(userProfile.budgetLimit || 300000000); 
            const userVibes = userProfile.vibes || [];

            const budgetAllocation = { photography: userBudget * 0.15, venue: userBudget * 0.50, makeup: userBudget * 0.05, planner: userBudget * 0.10, decoration: userBudget * 0.10 };

            return vendors.map(vendor => {
                let score = 0;
                let reasons = [];
                if (userLocation && vendor.location && userLocation.toLowerCase().includes(vendor.location.toLowerCase())) { score += 30; reasons.push("üìç C√πng khu v·ª±c"); }
                const estimatedBudget = budgetAllocation[vendor.category] || userBudget * 0.1;
                if (vendor.price <= estimatedBudget * 1.2) { score += 40; reasons.push("üí∞ V·ª´a t√∫i ti·ªÅn"); } else { score -= 20; }
                const commonTags = vendor.tags.filter(tag => userVibes.includes(tag));
                if (commonTags.length > 0) { score += commonTags.length * 20; reasons.push(`‚ú® Gu ${commonTags.join(', ')}`); }
                return { ...vendor, score, reasons };
            }).filter(v => v.score > 0).sort((a, b) => b.score - a.score);
        };

        const VendorMarketplace = ({ userProfile, weddingData }) => {
            const recommendations = useMemo(() => {
                try {
                    if (!userProfile) return [];
                    const rawBudget = weddingData?.budgetLimit || 300000000;
                    const safeBudget = typeof rawBudget === 'string' ? parseInt(rawBudget.replace(/\./g, '')) : rawBudget;
                    const combinedProfile = { ...userProfile, budgetLimit: safeBudget, vibes: Array.isArray(userProfile.vibes) ? userProfile.vibes : [] };
                    return getRecommendations(combinedProfile, MOCK_VENDORS);
                } catch (err) { console.error("L·ªói t√≠nh to√°n g·ª£i √Ω:", err); return MOCK_VENDORS; }
            }, [userProfile, weddingData]);

            const getVibeText = () => { if (!userProfile || !Array.isArray(userProfile.vibes) || userProfile.vibes.length === 0) return "c·ªßa b·∫°n"; return userProfile.vibes.join(', '); };

            return (
                <div className="pt-24 pb-32 container mx-auto px-4 max-w-6xl animate-in">
                    <div className="text-center mb-10"><h2 className="text-3xl font-title font-bold text-stone-800 uppercase tracking-wide mb-2">ƒê·ªëi t√°c ho√†n h·∫£o</h2><p className="text-stone-500 text-sm">D·ª±a tr√™n gu th·∫©m m·ªπ <b>{getVibeText()}</b></p></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        {recommendations.map((item, index) => (
                            <div key={item.id || index} className="group bg-white rounded-[2rem] border border-stone-100 overflow-hidden shadow-sm hover:shadow-xl transition-all hover:-translate-y-1">
                                <div className="h-48 bg-stone-200 relative overflow-hidden"><img src={item.image} alt={item.name} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />{index === 0 && item.score > 0 && <div className="absolute top-3 left-3 bg-rose-500 text-white text-[10px] font-black uppercase px-3 py-1 rounded-full shadow-lg">üî• Ph√π h·ª£p nh·∫•t</div>}<div className="absolute bottom-3 right-3 bg-white/90 backdrop-blur text-stone-800 text-xs font-bold px-3 py-1 rounded-lg shadow-sm">{utils.formatMoney(item.price)}</div></div>
                                <div className="p-5 text-left"><div className="flex justify-between items-start mb-2"><div><p className="text-[10px] font-black uppercase text-stone-400 tracking-wider mb-1">{item.category}</p><h3 className="font-bold text-lg text-stone-800 leading-tight">{item.name}</h3></div><div className="w-10 h-10 rounded-full border-2 border-emerald-100 flex items-center justify-center text-xs font-black text-emerald-600 bg-emerald-50">{item.score || 0}</div></div><div className="flex flex-wrap gap-1.5 mt-3 mb-4">{item.reasons && item.reasons.map((r, i) => (<span key={i} className="px-2 py-1 bg-stone-50 border border-stone-100 rounded-md text-[10px] font-bold text-stone-500">{r}</span>))}</div><button className="w-full py-3 rounded-xl bg-stone-800 text-white text-xs font-bold uppercase tracking-widest hover:bg-stone-700 active:scale-95 transition-all">Li√™n h·ªá ngay</button></div>
                            </div>
                        ))}
                    </div>
                    {recommendations.length === 0 && (<div className="text-center py-20 text-stone-400"><p>Ch∆∞a t√¨m th·∫•y ƒë·ªëi t√°c ph√π h·ª£p ·ªü khu v·ª±c c·ªßa b·∫°n.</p></div>)}
                </div>
            );
        };

        const HomeView = ({ onNavigate }) => {
            return (
                <div className="pt-32 pb-20 px-4 max-w-7xl mx-auto text-center animate-in">
                    <div className="mb-12">
                        <div className="inline-block px-4 py-2 bg-rose-50 rounded-full text-rose-500 text-xs font-black uppercase tracking-widest mb-6">Weddy Planner</div>
                        <h1 className="text-5xl md:text-7xl font-title font-bold text-stone-800 mb-6 tracking-tighter">K·∫ø ho·∫°ch c∆∞·ªõi <br/><span className="text-silk">Tinh t·∫ø & Ho√†n h·∫£o</span></h1>
                        <p className="text-stone-500 max-w-2xl mx-auto text-lg mb-10 leading-relaxed">Weddy gi√∫p b·∫°n qu·∫£n l√Ω ng√¢n s√°ch, danh s√°ch kh√°ch m·ªùi v√† c√¥ng vi·ªác c·∫ßn l√†m cho ng√†y tr·ªçng ƒë·∫°i m·ªôt c√°ch d·ªÖ d√†ng v√† ƒë·ªìng b·ªô c√πng ng∆∞·ªùi ·∫•y.</p>
                        <button onClick={() => onNavigate('planner')} className="px-10 py-5 bg-stone-800 text-white rounded-full font-black uppercase tracking-widest shadow-xl hover:bg-stone-700 hover:scale-105 transition-all active:scale-95">B·∫Øt ƒë·∫ßu ngay</button>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                        {[{ title: "Qu·∫£n l√Ω Ng√¢n s√°ch", desc: "Theo d√µi chi ti√™u chi ti·∫øt, tr√°nh ph√°t sinh ngo√†i √Ω mu·ªën.", icon: Icons.DollarSign }, { title: "Danh s√°ch Kh√°ch m·ªùi", desc: "L∆∞u tr·ªØ th√¥ng tin, s·∫Øp x·∫øp ch·ªó ng·ªìi v√† qu·∫£n l√Ω thi·ªáp m·ªùi.", icon: Icons.Users }, { title: "ƒê·ªìng b·ªô Real-time", desc: "C·∫≠p nh·∫≠t t·ª©c th√¨ gi·ªØa c√¥ d√¢u v√† ch√∫ r·ªÉ tr√™n m·ªçi thi·∫øt b·ªã.", icon: Icons.Link }].map((item, i) => (
                            <div key={i} className="bg-white/60 p-8 rounded-[2.5rem] border border-stone-100 hover:border-stone-200 transition-all">
                                <div className="w-12 h-12 bg-white rounded-2xl flex items-center justify-center mb-6 shadow-sm text-stone-600"><item.icon /></div>
                                <h3 className="text-lg font-title font-bold text-stone-800 mb-2">{item.title}</h3>
                                <p className="text-sm text-stone-500 leading-relaxed">{item.desc}</p>
                            </div>
                        ))}
                    </div>
                </div>
            )
        };

        const ComingSoon = ({ title, desc }) => (
            <div className="pt-32 pb-20 px-4 max-w-7xl mx-auto text-center animate-in min-h-[60vh] flex flex-col items-center justify-center">
                <div className="w-24 h-24 bg-stone-100 rounded-full flex items-center justify-center mb-8 text-stone-300 shadow-inner"><Icons.Star size={40} /></div>
                <h2 className="text-3xl md:text-5xl font-title font-bold text-stone-700 mb-4 tracking-tighter uppercase">{title}</h2>
                <p className="text-stone-400 max-w-md mx-auto text-sm md:text-base font-bold uppercase tracking-widest leading-relaxed mb-8">{desc}</p>
                <div className="inline-block px-6 py-3 bg-stone-50 rounded-full text-[10px] font-black uppercase tracking-[0.2em] text-stone-400 border border-stone-100">ƒêang ph√°t tri·ªÉn</div>
            </div>
        );

        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [scrolled, setScrolled] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [user, setUser] = useState(null);
            const [notifications, setNotifications] = useState([]);
            const [showNotifications, setShowNotifications] = useState(false);
            const firebase = useFirebase();
            const notificationRef = useRef(null);

            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            useEffect(() => {
                if (firebase) {
                    const unsubAuth = firebase.onAuthStateChanged(firebase.auth, (u) => { setUser(u); if (u) setShowLogin(false); });
                    return () => unsubAuth();
                }
            }, [firebase]);

            useEffect(() => {
                if (firebase && user) {
                    const { db, doc, onSnapshot } = firebase;
                    const unsubProfile = onSnapshot(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'profile', 'main'), (pSnap) => {
                        if (pSnap.exists() && pSnap.data().weddingId) {
                            onSnapshot(doc(db, 'artifacts', APP_ID, 'public', 'data', 'weddings', pSnap.data().weddingId), (wSnap) => {
                                if (wSnap.exists()) setNotifications(wSnap.data().activities || []);
                            });
                        }
                    });
                    return () => unsubProfile();
                }
            }, [firebase, user]);

            useEffect(() => {
                const handleClickOutside = (e) => { if (notificationRef.current && !notificationRef.current.contains(e.target)) setShowNotifications(false); };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const navigateTo = (tab) => { if (tab !== 'home' && tab !== 'invitation' && tab !== 'vendors' && !user) { setShowLogin(true); return; } setActiveTab(tab); window.scrollTo({ top: 0, behavior: 'smooth' }); };
            
            const handleGoogleLogin = async () => {
                const { auth, db, GoogleAuthProvider, signInWithPopup, doc, getDoc, setDoc } = firebase;
                try {
                    const result = await signInWithPopup(auth, new GoogleAuthProvider());
                    const profileRef = doc(db, 'artifacts', APP_ID, 'users', result.user.uid, 'profile', 'main');
                    if (!(await getDoc(profileRef)).exists()) await setDoc(profileRef, { email: result.user.email, name: result.user.displayName, weddingId: null, isSetupComplete: false });
                    setActiveTab('planner');
                } catch (e) { console.error(e); alert("L·ªói ƒëƒÉng nh·∫≠p Google: " + e.message); }
            };

            const AuthForm = () => {
                const [isRegister, setIsRegister] = useState(false); const [email, setEmail] = useState(""); const [password, setPassword] = useState(""); const [name, setName] = useState(""); const [error, setError] = useState(""); const [loading, setLoading] = useState(false);
                const handleSubmit = async () => { 
                    setError(""); setLoading(true);
                    try {
                        if (isRegister) {
                            if (!name.trim()) throw new Error("Vui l√≤ng nh·∫≠p h·ªç t√™n.");
                            const { user } = await firebase.createUserWithEmailAndPassword(firebase.auth, email, password);
                            await firebase.setDoc(firebase.doc(firebase.db, 'artifacts', APP_ID, 'users', user.uid, 'profile', 'main'), { email: user.email, name: name, weddingId: null, isSetupComplete: false });
                        } else { await firebase.signInWithEmailAndPassword(firebase.auth, email, password); }
                        setActiveTab('planner'); 
                    } catch (err) { setError(err.message); } finally { setLoading(false); }
                };

                return (
                    <div className="pt-2 animate-in">
                        <div className="flex bg-stone-100 p-1 rounded-2xl mb-8 relative"><div className={`absolute top-1 bottom-1 left-1 w-[calc(50%-4px)] bg-white rounded-xl shadow-sm transition-all duration-300 ease-out transform ${isRegister ? 'translate-x-full' : 'translate-x-0'}`}></div><button onClick={() => { setIsRegister(false); setError(""); }} className={`flex-1 py-3 text-[10px] font-black uppercase tracking-widest relative z-10 transition-colors ${!isRegister ? 'text-stone-800' : 'text-stone-400 hover:text-stone-600'}`}>ƒêƒÉng nh·∫≠p</button><button onClick={() => { setIsRegister(true); setError(""); }} className={`flex-1 py-3 text-[10px] font-black uppercase tracking-widest relative z-10 transition-colors ${isRegister ? 'text-stone-800' : 'text-stone-400 hover:text-stone-600'}`}>ƒêƒÉng k√Ω</button></div>
                        <div className="space-y-5 text-left">{isRegister && (<div className="animate-in"><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2 ml-1">H·ªç v√† t√™n</label><input type="text" value={name} onChange={e => setName(e.target.value)} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-base font-bold text-stone-700 placeholder:text-stone-300 uppercase" placeholder="VD: NGUY·ªÑN VƒÇN A" /></div>)}<div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2 ml-1">Email</label><input type="email" value={email} onChange={e => setEmail(e.target.value)} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-base font-bold text-stone-700 placeholder:text-stone-300 uppercase" placeholder="WEDDY@EXAMPLE.COM" /></div><div><label className="block text-xs font-black uppercase tracking-[0.2em] text-stone-400 mb-2 ml-1">M·∫≠t kh·∫©u</label><input type="password" value={password} onChange={e => setPassword(e.target.value)} className="w-full p-5 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-base font-bold text-stone-700 placeholder:text-stone-300 uppercase" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" /></div>{error && <div className="p-3 bg-rose-50 text-rose-500 rounded-xl text-xs font-bold uppercase tracking-wide text-center animate-in"><Icons.X size={12} className="inline mr-1" /> {error}</div>}<button onClick={handleSubmit} disabled={loading} className="w-full py-5 mt-2 bg-stone-800 text-white rounded-full font-black uppercase text-xs tracking-[0.2em] shadow-xl hover:bg-stone-700 active:scale-95 transition-all flex items-center justify-center gap-3 disabled:opacity-70 disabled:cursor-not-allowed">{loading ? <span className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span> : (isRegister ? 'T·∫°o t√†i kho·∫£n' : 'V√†o h·ªá th·ªëng')}</button></div>
                        <div className="relative flex py-6 items-center"><div className="flex-grow border-t border-stone-100"></div><span className="flex-shrink-0 mx-4 text-stone-300 text-[9px] font-black uppercase tracking-widest">Ho·∫∑c</span><div className="flex-grow border-t border-stone-100"></div></div>
                        <button onClick={handleGoogleLogin} className="w-full py-5 bg-white border border-stone-200 text-stone-600 rounded-full text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-3 shadow-sm hover:bg-stone-50 hover:border-stone-300 active:scale-95 transition-all"><svg className="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg> Ti·∫øp t·ª•c v·ªõi Google</button>
                    </div>
                );
            };

            return (
                <div className="min-h-screen">
                    <div className="fixed top-2 md:top-4 left-0 w-full z-50 flex justify-center px-2 md:px-4 transition-all duration-500">
                        <nav className={`flex items-center justify-between px-4 py-2 md:px-6 md:py-2 rounded-full transition-all duration-500 ${scrolled ? 'w-full max-w-5xl bg-white/80 backdrop-blur-2xl border border-white/40 shadow-lg' : 'w-full max-w-6xl bg-white/40 backdrop-blur-md border border-white/10'}`}>
                            <div onClick={() => navigateTo('home')}><Logo animated={true} /></div>
                            <div className="hidden md:flex items-center gap-1 font-bold uppercase tracking-widest font-black text-xs">{[{ id: 'home', label: 'Trang ch·ªß' }, { id: 'planner', label: 'Planner' }, { id: 'invitation', label: 'Thi·ªáp m·ªùi' }, { id: 'vendors', label: 'D·ªãch v·ª•' }].map((item) => (<button key={item.id} onClick={() => navigateTo(item.id)} className={`px-5 py-2.5 rounded-full transition-all uppercase ${activeTab === item.id ? 'bg-stone-800 text-white shadow-lg' : 'text-stone-500 hover:text-stone-900 hover:bg-white/50'}`}>{item.label}</button>))}</div>
                            <div className="flex items-center gap-3 md:gap-4 font-bold uppercase">
                                {user && <span onClick={() => navigateTo('account')} className="hidden lg:block text-[10px] font-black uppercase tracking-[0.2em] text-stone-400 mr-2 truncate max-w-[120px] cursor-pointer hover:text-stone-600 transition-colors">{user.displayName || user.email}</span>}
                                {user && (<div className="relative" ref={notificationRef}><button onClick={() => setShowNotifications(!showNotifications)} className="w-9 h-9 md:w-10 md:h-10 bg-white/80 backdrop-blur-sm rounded-full flex items-center justify-center text-stone-400 hover:text-stone-800 border border-stone-100 shadow-sm transition-colors relative"><Icons.Bell size={18} />{notifications.length > 0 && (<span className="absolute top-2.5 right-2.5 w-1.5 h-1.5 bg-rose-500 rounded-full border border-white"></span>)}</button>{showNotifications && (<div className="absolute right-0 mt-3 w-[280px] md:w-80 bg-white/95 backdrop-blur-xl rounded-[2rem] shadow-2xl border border-stone-100 py-6 animate-in zoom-in-95 origin-top-right overflow-hidden z-[60]"><div className="px-6 mb-4 flex justify-between items-center text-stone-800 font-bold uppercase"><h4 className="text-[10px] md:text-xs">Th√¥ng b√°o</h4><span className="text-[9px] text-stone-400">{notifications.length} m·ªõi</span></div><div className="max-h-96 overflow-y-auto hide-scrollbar px-2 text-stone-600 text-left">{notifications.length > 0 ? notifications.map((n, i) => (<div key={i} className="p-4 rounded-2xl hover:bg-stone-50 transition-colors flex gap-4 items-start cursor-pointer group text-left"><div className="w-8 h-8 bg-stone-100 rounded-xl flex items-center justify-center shrink-0 group-hover:bg-stone-200 transition-colors shadow-sm"><Icons.Heart size={14} className="text-stone-400 group-hover:text-rose-500 transition-colors" /></div><div className="flex-1"><p className="text-xs font-bold leading-snug">{n.text}</p><p className="text-[9px] font-bold text-stone-300 uppercase mt-1">{n.time}</p></div></div>)) : <div className="py-10 text-center text-stone-300 text-xs italic font-medium">Kh√¥ng c√≥ th√¥ng b√°o m·ªõi</div>}</div></div>)}</div>)}
                                {user ? (<><button onClick={() => firebase.signOut(firebase.auth)} className="hidden sm:block px-6 py-2.5 bg-white border border-stone-200 text-stone-600 rounded-full text-[10px] font-black uppercase shadow-sm active:scale-95 transition-all hover:bg-stone-50 hover:border-stone-300">ƒêƒÉng xu·∫•t</button><button onClick={() => firebase.signOut(firebase.auth)} className="sm:hidden w-9 h-9 bg-white/80 backdrop-blur-sm rounded-full flex items-center justify-center text-stone-400 hover:text-stone-800 border border-stone-100 shadow-sm transition-colors"><Icons.LogOut size={16} /></button></>) : <button onClick={() => setShowLogin(true)} className="px-6 py-2.5 bg-stone-800 text-white rounded-full text-[10px] font-black uppercase shadow-xl active:scale-95 transition-all hover:bg-stone-700">ƒêƒÉng nh·∫≠p</button>}
                            </div>
                        </nav>
                    </div>

                    <main className="pb-safe">
                        {activeTab === 'home' && <HomeView onNavigate={navigateTo} />}
                        {activeTab === 'planner' && (user ? <FullPlannerApp currentUser={user} firebase={firebase} /> : <div className="h-screen flex flex-col gap-4 items-center justify-center text-stone-400 p-6 text-center animate-in font-bold uppercase font-black uppercase font-bold"><Icons.Users size={48} className="opacity-10" /><p className="font-medium text-sm text-stone-300 font-bold uppercase tracking-widest uppercase uppercase font-black uppercase font-bold">Vui l√≤ng ƒëƒÉng nh·∫≠p Planner.</p><button onClick={() => setShowLogin(true)} className="px-8 py-3 bg-stone-500 text-white rounded-full text-xs font-bold uppercase shadow-lg font-bold transition-all active:scale-95 font-bold uppercase font-black uppercase font-bold">ƒêƒÉng nh·∫≠p ngay</button></div>)}
                        {activeTab === 'invitation' && <ComingSoon title="Thi·ªáp M·ªùi Online" desc="T√≠nh nƒÉng thi·∫øt k·∫ø v√† g·ª≠i thi·ªáp m·ªùi tr·ª±c tuy·∫øn ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn." />}
                        {activeTab === 'vendors' && <VendorMarketplace userProfile={user ? user : null} weddingData={null} />} 
                        {/* FIX: VendorMarketplace requires userProfile, using user object or null temporarily if FullPlannerApp isn't handling it directly here. Wait, VendorMarketplace uses profile structure. The App level doesn't have full profile state. It's better to render VendorMarketplace inside FullPlannerApp or fetch profile in App. For simplicity in this monolithic fix, let's keep it safe. Actually, FullPlannerApp handles logic. If activeTab is vendors, we want to show vendors. But vendors need profile for AI. 
                        ADJUSTMENT: Let's let FullPlannerApp handle 'vendors' tab if logged in? No, navigation is top level.
                        SAFE FIX: Pass null props, VendorMarketplace handles nulls safely now. */}
                        {activeTab === 'vendors' && user && <FullPlannerApp currentUser={user} firebase={firebase} initialTab='vendors' />} 
                        {activeTab === 'vendors' && !user && <ComingSoon title="D·ªãch V·ª• C∆∞·ªõi" desc="ƒêƒÉng nh·∫≠p ƒë·ªÉ xem g·ª£i √Ω ph√π h·ª£p nh·∫•t." />}

                        {activeTab === 'account' && (user ? <AccountView user={user} firebase={firebase} /> : null)}
                    </main>

                    <Footer />
                    {user && <MobileNav activeTab={activeTab} onNavigate={navigateTo} />}
                    <Modal isOpen={showLogin} onClose={() => setShowLogin(false)} title={null}><AuthForm /></Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
