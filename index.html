<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Weddy - Nền tảng quản lý đám cưới tinh tế</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dosis:wght@200;300;400;500;600;700;800&display=swap');
        body { font-family: 'Dosis', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.8s ease-out forwards; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes silk-shine { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
        .text-silk {
            background: linear-gradient(90deg, #806233 0%, #CC9C53 25%, #FFECB3 50%, #CC9C53 75%, #806233 100%);
            background-size: 200% auto; color: #000; background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: silk-shine 5s linear infinite;
        }
        @keyframes subtle-zoom { 0% { transform: scale(1); } 100% { transform: scale(1.05); } }
        .bg-zoom { animation: subtle-zoom 20s infinite alternate; }
        /* Safe area for iPhone X+ */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-[#F0EBE5] text-stone-700 transition-colors duration-500 overflow-x-hidden">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot, getDoc, collection } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Cấu hình Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD_F3OI5GexlAqgC8TZ1CN1JB5O3RacQqs",
            authDomain: "weddyvn.firebaseapp.com",
            projectId: "weddyvn",
            storageBucket: "weddyvn.firebasestorage.app",
            messagingSenderId: "504927899297",
            appId: "1:504927899297:web:1a3d3a1b6cfafe0716aae0",
            measurementId: "G-KK4B3RXVNV"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            window.firebaseServices = { auth, db, signInWithEmailAndPassword, onAuthStateChanged, doc, setDoc, updateDoc, onSnapshot, getDoc, collection, GoogleAuthProvider, signInWithPopup, signOut, createUserWithEmailAndPassword };
        } catch (e) { console.error("Firebase Error:", e); }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // --- 1. GLOBAL CONSTANTS & UTILS ---
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'weddy-stable-final';
        
        const utils = {
            formatMoney: (a) => {
                if (!a || a === 0) return "0 VNĐ";
                return a >= 1000000000 ? (a/1000000000).toLocaleString('vi-VN', { maximumFractionDigits: 2 }) + " Tỷ VNĐ" : (a/1000000).toLocaleString('vi-VN', { maximumFractionDigits: 2 }) + " Triệu VNĐ";
            },
            formatInput: (v) => v ? v.toString().replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ".") : "",
            parseInput: (v) => v ? parseInt(v.toString().replace(/\./g, '')) || 0 : 0,
            getDaysLeft: (d) => {
                if (!d || d === "Chưa đặt") return "---";
                const diff = Math.ceil((new Date(d).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24));
                return diff > 0 ? `${diff} NGÀY NỮA` : (diff === 0 ? "HÔM NAY" : "ĐÃ QUA");
            },
            genInvite: () => Math.floor(100000 + Math.random() * 900000).toString()
        };

        const Icon = ({ children, size = 24, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );

        const Icons = {
            Heart: (p) => <Icon {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></Icon>,
            Check: (p) => <Icon {...p}><polyline points="20 6 9 17 4 12" /></Icon>,
            Users: (p) => <Icon {...p}><g><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></g></Icon>,
            Plus: (p) => <Icon {...p}><path d="M5 12h14" /><path d="M12 5v14" /></Icon>,
            Layout: (p) => <Icon {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><path d="M3 9h18" /><path d="M9 21V9" /></Icon>,
            DollarSign: (p) => <Icon {...p}><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></Icon>,
            X: (p) => <Icon {...p}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></Icon>,
            ChevronRight: (p) => <Icon {...p}><path d="m9 18 6-6-6-6" /></Icon>,
            Link: (p) => <Icon {...p}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></Icon>,
            Share: (p) => <Icon {...p}><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" x2="15.42" y1="13.51" y2="17.49" /><line x1="15.41" x2="8.59" y1="6.51" y2="10.49" /></Icon>,
            Trash: (p) => <Icon {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></Icon>,
            Bell: (p) => <Icon {...p}><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" /></Icon>,
            Menu: (p) => <Icon {...p}><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></Icon>,
            Edit: (p) => <Icon {...p}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" /></Icon>,
            ArrowUpRight: (p) => <Icon {...p}><path d="M7 7h10v10" /><path d="M7 17 17 7" /></Icon>,
            Star: (p) => <Icon {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></Icon>,
            Home: (p) => <Icon {...p}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></Icon>
        };

        // --- 2. HOOKS ---
        const useFirebase = () => {
            const [services, setServices] = useState(null);
            useEffect(() => {
                const interval = setInterval(() => { if (window.firebaseServices) { setServices(window.firebaseServices); clearInterval(interval); } }, 100);
                return () => clearInterval(interval);
            }, []);
            return services;
        };

        // --- 3. SUB-COMPONENTS ---
        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 animate-in">
                    {/* Backdrop: Màu tối mờ nhẹ (như cũ), phủ kín màn hình */}
                    <div className="absolute inset-0 bg-stone-900/30 backdrop-blur-sm transition-all" onClick={onClose}></div>
                    
                    {/* Popup: Dạng Card nằm giữa, bo tròn sang trọng */}
                    <div className="relative bg-white/95 backdrop-blur-xl rounded-[2.5rem] p-6 md:p-8 w-full max-w-md shadow-2xl border border-stone-100 flex flex-col max-h-[90vh] overflow-y-auto hide-scrollbar text-stone-700">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-lg font-black uppercase tracking-widest text-stone-600">{title}</h3>
                            <button onClick={onClose} className="w-8 h-8 flex items-center justify-center rounded-full bg-stone-50 hover:bg-stone-100 transition-colors shrink-0">
                                <Icons.X size={16} />
                            </button>
                        </div>
                        {children}
                    </div>
                </div>
            );
        };

        // --- FIXED: GettingStartedWizard (Redesigned & Logic Fix) ---
        const GettingStartedWizard = ({ onComplete }) => {
            const [step, setStep] = useState(0);
            const [data, setData] = useState({ role: "", date: "", location: "", budget: "" });
            const [isSubmitting, setIsSubmitting] = useState(false);

            const steps = [
                { 
                    title: "Chào mừng bạn,", 
                    subtitle: "Hãy chọn vai trò của bạn để bắt đầu.",
                    content: (<div className="grid grid-cols-2 gap-4 mt-8 font-bold">{["Cô dâu", "Chú rể"].map(r => (<button key={r} onClick={() => setData({ ...data, role: r })} className={`p-8 rounded-[2rem] border transition-all shadow-sm ${data.role === r ? 'border-stone-800 bg-stone-800 text-white shadow-xl scale-105' : 'border-white bg-white hover:border-stone-300'}`}>{r}</button>))}</div>) 
                },
                { 
                    title: "Ngày trọng đại?", 
                    subtitle: "Ngày mà hai bạn về chung một nhà.",
                    content: (<div className="mt-8"><input type="date" value={data.date} onChange={e => setData({ ...data, date: e.target.value })} className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-5 text-xl font-bold text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm text-center uppercase tracking-widest"/></div>) 
                },
                { 
                    title: "Tổ chức ở đâu?", 
                    subtitle: "Địa điểm diễn ra hôn lễ.",
                    content: (<div className="mt-8"><input type="text" value={data.location} onChange={e => setData({ ...data, location: e.target.value })} placeholder="Vd: White Palace, Tại gia..." className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-5 text-lg font-bold text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm placeholder:text-stone-300 uppercase text-center"/></div>) 
                },
                { 
                    title: "Ngân sách dự kiến?", 
                    subtitle: "Con số ước tính cho đám cưới.",
                    content: (<div className="mt-8"><div className="relative"><input type="text" value={data.budget} onChange={e => setData({ ...data, budget: utils.formatInput(e.target.value) })} placeholder="300.000.000" className="w-full bg-white border-0 ring-1 ring-stone-200 rounded-[1.5rem] px-6 py-5 pl-8 pr-20 text-2xl font-black text-stone-700 focus:ring-2 focus:ring-stone-500 outline-none shadow-sm placeholder:text-stone-200 text-center"/><div className="absolute right-8 top-1/2 -translate-y-1/2 text-stone-400 font-bold text-xs uppercase tracking-widest">VNĐ</div></div></div>) 
                }
            ];

            const current = steps[step];

            const handleFinish = async () => {
                if (isSubmitting) return;
                setIsSubmitting(true);
                try {
                    await onComplete({...data, budget: utils.parseInput(data.budget)});
                } catch (e) {
                    console.error("Wizard Error", e);
                    setIsSubmitting(false);
                    alert("Có lỗi xảy ra, vui lòng thử lại.");
                }
            };

            return (
                <div className="fixed inset-0 z-[200] bg-[#F0EBE5]/90 backdrop-blur-xl flex flex-col animate-in">
                    <div className="flex-1 flex flex-col justify-center px-8 max-w-lg mx-auto w-full text-center">
                        <div className="mb-12">
                            <div className="flex justify-center gap-1.5 mb-8">
                                {steps.map((_, i) => (
                                    <div key={i} className={`h-1.5 rounded-full transition-all duration-700 ${i <= step ? 'bg-stone-800 w-8' : 'bg-stone-300/50 w-2'}`}></div>
                                ))}
                            </div>
                            <h2 className="text-3xl md:text-4xl font-black tracking-tighter text-stone-800 mb-2">{current.title}</h2>
                            <p className="text-stone-500 text-sm font-medium">{current.subtitle}</p>
                        </div>
                        
                        <div className="min-h-[200px] flex flex-col justify-center">
                            {current.content}
                        </div>
                        
                        <div className="mt-16">
                            {step < steps.length - 1 ? (
                                <button 
                                    onClick={() => setStep(step + 1)} 
                                    disabled={(step === 0 && !data.role) || (step === 1 && !data.date) || (step === 2 && !data.location)} 
                                    className="w-full py-5 bg-stone-800 text-white rounded-full text-xs font-black uppercase tracking-[0.2em] shadow-xl hover:bg-stone-700 disabled:opacity-30 disabled:cursor-not-allowed transition-all active:scale-95"
                                >
                                    Tiếp tục
                                </button>
                            ) : (
                                <button 
                                    onClick={handleFinish} 
                                    disabled={isSubmitting}
                                    className="w-full py-5 bg-emerald-700 text-white rounded-full text-xs font-black uppercase tracking-[0.2em] shadow-xl hover:bg-emerald-800 disabled:opacity-70 transition-all active:scale-95 flex items-center justify-center gap-3"
                                >
                                    {isSubmitting ? <span className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span> : null}
                                    {isSubmitting ? 'Đang xử lý...' : 'Hoàn tất thiết lập'}
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const PlannerOverview = ({ spentAmount, completedTasks, totalTasks, guestCount, budgetLimit, role, activities, onInvite, onEditBudget, onOpenGuests }) => {
            const percentage = Math.min((spentAmount / (budgetLimit || 300000000)) * 100, 100);
            return (
                <div className="max-w-6xl mx-auto space-y-8 animate-in text-stone-700 text-left px-2 md:px-0">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
                        <div className="lg:col-span-2 space-y-6 md:space-y-8">
                            <div className="bg-white/40 backdrop-blur-md p-6 rounded-[2.5rem] border border-stone-200/50 flex flex-col md:flex-row items-center justify-between gap-4 shadow-sm text-stone-800 text-sm">
                                <div className="flex items-center gap-4">
                                    <div className="w-12 h-12 bg-rose-100/50 rounded-full flex items-center justify-center text-rose-500 shrink-0"><Icons.Heart size={20} fill="currentColor"/></div>
                                    <div><h4 className="font-bold">Ví chung đôi mình</h4><p className="text-xs text-stone-400">Kết nối và đồng bộ kế hoạch với bạn đời.</p></div>
                                </div>
                                <button onClick={onInvite} className="w-full md:w-auto px-6 py-3 bg-stone-500 text-white rounded-full text-[10px] font-black uppercase tracking-widest shadow-sm hover:bg-stone-600 transition-all flex items-center justify-center gap-2"><Icons.Share size={14}/> Mời bạn đời</button>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-white/80 p-6 md:p-10 rounded-[2.5rem] border border-stone-100 shadow-sm flex flex-col justify-between h-44 md:h-48 text-left">
                                    <div className="flex justify-between items-start text-left uppercase tracking-widest text-[10px] font-bold text-stone-400"><span>Tiến độ</span><div className="w-10 h-10 bg-stone-50/50 rounded-2xl flex items-center justify-center text-stone-300"><Icons.Check size={18}/></div></div>
                                    <div><div className="flex items-baseline gap-2 mb-3 text-left font-black text-stone-600 text-3xl md:text-5xl"><span>{completedTasks}</span><span className="text-stone-300 uppercase text-[11px]">/ {totalTasks} việc</span></div><div className="w-full h-1.5 bg-stone-100 rounded-full overflow-hidden"><div className="h-full bg-stone-500 transition-all duration-700" style={{width: `${totalTasks > 0 ? (completedTasks/totalTasks)*100 : 0}%`}}></div></div></div>
                                </div>
                                <div onClick={onOpenGuests} className="bg-white/80 p-6 md:p-10 rounded-[2.5rem] border border-stone-100 shadow-sm flex flex-col justify-between h-44 md:h-48 cursor-pointer hover:border-stone-300 transition-all active:scale-[0.98]">
                                    <div className="flex justify-between items-start text-left uppercase tracking-widest text-[10px] font-bold text-stone-400"><span>Khách mời</span><div className="w-10 h-10 bg-stone-50/50 rounded-2xl flex items-center justify-center text-stone-400"><Icons.Users size={18}/></div></div>
                                    <div className="flex items-baseline gap-2 text-stone-700 text-left font-black text-4xl md:text-6xl"><span>{guestCount}</span><span className="text-stone-300 font-bold uppercase text-[11px]">Người</span></div>
                                </div>
                            </div>
                            <div className="bg-stone-500 p-6 md:p-12 rounded-[3rem] text-white relative overflow-hidden shadow-xl group">
                                <div className="absolute top-0 right-0 w-80 h-80 bg-stone-400 rounded-full blur-[150px] opacity-20 -translate-y-1/2 translate-x-1/2 group-hover:opacity-40 transition-opacity duration-700"></div>
                                <div className="relative z-10 text-left">
                                    <h3 className="text-[10px] font-black uppercase tracking-[0.3em] text-white/70 mb-6 md:mb-8 text-left">Tài chính tổng quát ({role || 'Bạn'})</h3>
                                    <div className="flex flex-col md:flex-row justify-between gap-6 md:gap-8">
                                        <div className="flex-1 text-white text-left">
                                            <div className="text-[10px] uppercase font-black text-white/30 mb-2 text-left">Đã chi tiêu</div>
                                            <div className="text-4xl md:text-7xl font-black tracking-tighter text-left tabular-nums">{utils.formatMoney(spentAmount)}</div>
                                            <div className="w-full h-1.5 bg-white/10 rounded-full overflow-hidden mt-6 mb-4"><div className="h-full bg-white transition-all duration-700" style={{width: `${percentage}%`}}></div></div>
                                            <div className="flex items-center gap-2 group/budget inline-flex cursor-pointer text-white/80" onClick={onEditBudget}><p className="text-[12px] font-black uppercase tracking-widest font-bold">Ngân sách: {utils.formatMoney(budgetLimit)}</p><Icons.Edit size={14} className="text-white/20 group-hover/budget:text-white transition-colors" /></div>
                                        </div>
                                        <div className="md:w-48 flex flex-col gap-4 justify-center text-white"><div className="bg-white/10 backdrop-blur-sm p-5 md:p-6 rounded-3xl border border-white/5 text-center md:text-left shadow-sm shadow-inner"><p className="text-[9px] font-black text-white/40 uppercase mb-1 text-left">Còn lại</p><p className="text-xl font-bold text-left">{utils.formatMoney((budgetLimit || 300000000) - spentAmount)}</p></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div className="bg-white/60 backdrop-blur-md p-6 md:p-10 rounded-[2.5rem] border border-stone-100 shadow-sm h-full flex flex-col">
                            <h3 className="text-[11px] font-black uppercase tracking-[0.2em] mb-8 text-stone-700 border-b border-stone-100 pb-6 font-bold text-left uppercase">Hoạt động gần đây</h3>
                            <div className="space-y-6 flex-1 overflow-y-auto hide-scrollbar max-h-[400px] md:max-h-[500px]">
                                {activities?.length > 0 ? activities.map((act, i) => (
                                    <div key={i} className="flex gap-4 items-start group animate-in text-left">
                                        <div className="w-9 h-9 md:w-10 md:h-10 bg-stone-50 rounded-2xl flex items-center justify-center shrink-0 group-hover:bg-stone-500 group-hover:text-white transition-colors shadow-sm"><Icons.ArrowUpRight size={16} className="text-stone-300 group-hover:text-white" /></div>
                                        <div className="text-left text-stone-600"><p className="text-[12px] md:text-[13px] font-bold leading-snug text-left">{act.text}</p><p className="text-[10px] font-black text-stone-300 uppercase tracking-widest mt-1 text-left">{act.time}</p></div>
                                    </div>
                                )) : <p className="text-sm text-stone-300 italic font-medium text-center">Chưa có thông báo mới.</p>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const PlannerBudget = ({ tasks, onAddExpense }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [activeFilter, setActiveFilter] = useState('all'); // 'all', 'groom', 'bride'
            const [title, setTitle] = useState(""); const [cost, setCost] = useState(""); const [paid, setPaid] = useState(""); const [category, setCategory] = useState("Đặt tiệc cưới");
            
            // Lọc danh sách các công việc có chi phí
            const allBudgetTasks = (tasks || []).filter(t => t.cost > 0);
            
            // Phân loại theo vai trò
            const groomTasks = allBudgetTasks.filter(t => t.paidBy === 'Chú rể');
            const brideTasks = allBudgetTasks.filter(t => t.paidBy === 'Cô dâu');

            // Xác định danh sách hiển thị dựa trên filter
            let displayTasks = allBudgetTasks;
            if (activeFilter === 'groom') displayTasks = groomTasks;
            if (activeFilter === 'bride') displayTasks = brideTasks;

            // Tính toán thống kê dựa trên danh sách đang hiển thị
            const totalBudget = displayTasks.reduce((acc, curr) => acc + curr.cost, 0);
            const totalPaid = displayTasks.reduce((acc, curr) => acc + (curr.paid || (curr.status === 'done' ? curr.cost : 0)), 0);
            
            const handleSave = () => { 
                if (title.trim() && cost) { 
                    onAddExpense({ 
                        title: title.trim(), 
                        tag: category, 
                        status: utils.parseInput(paid) >= utils.parseInput(cost) ? 'done' : 'pending', 
                        cost: utils.parseInput(cost), 
                        paid: utils.parseInput(paid) 
                    }); 
                    setTitle(""); setCost(""); setPaid(""); setIsOpen(false); 
                } 
            };
            
            return (
                <div className="max-w-6xl mx-auto space-y-8 animate-in text-stone-700 px-2 md:px-0">
                    
                    {/* Filter Tabs */}
                    <div className="flex justify-center">
                        <div className="bg-stone-100 p-1.5 rounded-full flex gap-1">
                            {[
                                { id: 'all', label: 'Ví chung' }, 
                                { id: 'groom', label: 'Chú rể' }, 
                                { id: 'bride', label: 'Cô dâu' }
                            ].map(f => (
                                <button 
                                    key={f.id}
                                    onClick={() => setActiveFilter(f.id)}
                                    className={`px-4 md:px-6 py-2.5 rounded-full text-[10px] font-black uppercase tracking-widest transition-all ${activeFilter === f.id ? 'bg-white shadow-md text-stone-800' : 'text-stone-400 hover:text-stone-600'}`}
                                >
                                    {f.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Stats Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="bg-white p-8 rounded-[2.5rem] border border-stone-100 shadow-sm flex flex-col justify-between h-40">
                            <div className="flex justify-between items-start">
                                <p className="text-[10px] font-black uppercase tracking-[0.2em] text-stone-400">Dự kiến chi ({activeFilter === 'all' ? 'Tổng' : (activeFilter === 'groom' ? 'Nhà trai' : 'Nhà gái')})</p>
                                <div className="p-2 bg-stone-50 rounded-full text-stone-400"><Icons.DollarSign size={16}/></div>
                            </div>
                            <p className="text-2xl font-black text-stone-800 tracking-tighter">{utils.formatMoney(totalBudget)}</p>
                        </div>
                        <div className="bg-stone-800 p-8 rounded-[2.5rem] shadow-xl flex flex-col justify-between h-40 text-white">
                            <div className="flex justify-between items-start">
                                <p className="text-[10px] font-black uppercase tracking-[0.2em] text-white/50">Đã thanh toán</p>
                                <div className="p-2 bg-white/10 rounded-full text-white"><Icons.Check size={16}/></div>
                            </div>
                            <p className="text-2xl font-black tracking-tighter">{utils.formatMoney(totalPaid)}</p>
                        </div>
                        <div className="bg-white p-8 rounded-[2.5rem] border border-stone-100 shadow-sm flex flex-col justify-between h-40">
                            <div className="flex justify-between items-start">
                                <p className="text-[10px] font-black uppercase tracking-[0.2em] text-stone-400">Còn lại</p>
                                <div className="p-2 bg-stone-50 rounded-full text-stone-400"><Icons.Layout size={16}/></div>
                            </div>
                            <p className={`text-2xl font-black tracking-tighter ${totalBudget - totalPaid < 0 ? 'text-rose-500' : 'text-stone-800'}`}>{utils.formatMoney(totalBudget - totalPaid)}</p>
                        </div>
                    </div>

                    <div className="flex flex-col md:flex-row justify-between items-end md:items-center gap-4">
                         <div className="text-left">
                            <h3 className="text-2xl font-black text-stone-700 uppercase tracking-tighter">Chi tiết khoản chi</h3>
                            <p className="text-[10px] font-bold text-stone-400 uppercase tracking-widest mt-1">
                                {activeFilter === 'all' ? 'Toàn bộ danh sách' : (activeFilter === 'groom' ? 'Chi phí của Chú rể' : 'Chi phí của Cô dâu')}
                            </p>
                         </div>
                         <button onClick={() => setIsOpen(true)} className="group w-full md:w-auto flex items-center justify-center gap-3 px-6 py-4 bg-stone-200 text-stone-600 hover:bg-stone-300 rounded-full text-[10px] font-black uppercase tracking-widest transition-all active:scale-95 shadow-sm">
                            <Icons.Plus size={14}/> Thêm khoản chi
                         </button>
                    </div>

                    <div className="space-y-3">
                        {displayTasks.length === 0 ? (
                            <div className="py-20 text-center border-2 border-dashed border-stone-200 rounded-[2.5rem]">
                                <p className="text-stone-400 text-xs font-bold uppercase tracking-widest">Chưa có dữ liệu</p>
                            </div> 
                        ) : (
                            displayTasks.map((item, i) => (
                                <div key={i} className="group p-6 bg-white rounded-[2rem] border border-stone-100 hover:border-stone-300 transition-all flex flex-col md:flex-row md:items-center justify-between gap-4">
                                    <div className="flex items-center gap-5">
                                        <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 shadow-inner ${(item.paid || 0) >= item.cost ? 'bg-emerald-50 text-emerald-600' : 'bg-stone-50 text-stone-400'}`}>
                                            <Icons.DollarSign size={20} />
                                        </div>
                                        <div className="text-left">
                                            <h4 className="font-bold text-base text-stone-700 leading-tight uppercase">{item.title}</h4>
                                            <div className="flex gap-2 mt-1">
                                                <span className="inline-block text-[9px] font-black uppercase tracking-wider text-stone-400 bg-stone-50 px-2 py-0.5 rounded-lg border border-stone-100">{item.tag}</span>
                                                {item.paidBy && (
                                                    <span className={`inline-block text-[9px] font-black uppercase tracking-wider px-2 py-0.5 rounded-lg border border-transparent ${item.paidBy === 'Chú rể' ? 'bg-blue-50 text-blue-500' : (item.paidBy === 'Cô dâu' ? 'bg-rose-50 text-rose-500' : 'bg-stone-100 text-stone-500')}`}>
                                                        {item.paidBy}
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-end gap-1">
                                        <p className="font-black text-lg text-stone-800 tracking-tight">{utils.formatMoney(item.cost)}</p>
                                        <div className="flex items-center gap-2">
                                            {(item.paid || 0) >= item.cost ? (
                                                <span className="text-[9px] font-black uppercase tracking-widest text-emerald-600 bg-emerald-50 px-2 py-1 rounded-lg">Đã xong</span>
                                            ) : (
                                                <span className="text-[9px] font-black uppercase tracking-widest text-stone-400 bg-stone-50 px-2 py-1 rounded-lg">Đã trả: {utils.formatMoney(item.paid || 0)}</span>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>

                    <Modal isOpen={isOpen} onClose={() => setIsOpen(false)} title="Thêm khoản chi">
                        <div className="space-y-6 pt-2">
                            <div>
                                <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Tên khoản chi</label>
                                <input type="text" value={title} onChange={e=>setTitle(e.target.value)} className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-sm font-bold uppercase shadow-inner" placeholder="VD: CHỤP ẢNH CƯỚI" autoFocus />
                            </div>
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Hạng mục</label>
                                    <div className="relative">
                                        <select value={category} onChange={e=>setCategory(e.target.value)} className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl text-xs md:text-sm font-bold uppercase appearance-none focus:outline-none focus:border-stone-400 focus:bg-white transition-all shadow-inner">
                                            <option value="Đặt tiệc cưới">Tiệc cưới</option>
                                            <option value="Chụp ảnh">Chụp ảnh</option>
                                            <option value="Trang phục">Trang phục</option>
                                            <option value="Khác">Khác</option>
                                        </select>
                                        <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-stone-400"><Icons.ChevronRight size={14} className="rotate-90" /></div>
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Số tiền (VNĐ)</label>
                                    <input type="text" value={cost} onChange={e=>setCost(utils.formatInput(e.target.value))} className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-sm font-bold shadow-inner" placeholder="0" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Đã trả trước (VNĐ)</label>
                                <input type="text" value={paid} onChange={e=>setPaid(utils.formatInput(e.target.value))} className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-sm font-bold shadow-inner" placeholder="0" />
                            </div>
                            <div className="pt-6 border-t border-stone-50">
                                <button onClick={handleSave} className="w-full py-4 bg-stone-800 text-white rounded-full font-black uppercase text-xs tracking-[0.2em] shadow-xl hover:bg-stone-700 active:scale-95 transition-all flex items-center justify-center gap-3"><Icons.Plus size={14} strokeWidth={3}/> Lưu lại</button>
                            </div>
                        </div>
                    </Modal>
                </div>
            );
        };

        const PlannerTasks = ({ tasks, onAddTask, onToggleTask, onDeleteTask }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [title, setTitle] = useState(""); const [cat, setCat] = useState("Đặt tiệc cưới"); const [cost, setCost] = useState("");
            const handleAdd = () => { if (title.trim()) { onAddTask({ title: title.trim(), tag: cat, status: "pending", cost: utils.parseInput(cost), paid: 0 }); setTitle(""); setCost(""); setIsOpen(false); } };
            const pending = tasks?.filter(t => t.status !== 'done') || [];
            const done = tasks?.filter(t => t.status === 'done') || [];
            
            return (
                <div className="max-w-6xl mx-auto space-y-8 animate-in text-stone-700 text-left px-2 md:px-0">
                    <div className="flex flex-col md:flex-row justify-between items-end md:items-center gap-4">
                         <div className="text-left">
                            <h3 className="text-2xl font-black text-stone-700 uppercase tracking-tighter">Danh sách công việc</h3>
                            <p className="text-[10px] font-bold text-stone-400 uppercase tracking-widest mt-1">
                                {pending.length} việc cần làm
                            </p>
                         </div>
                         <button onClick={() => setIsOpen(true)} className="group w-full md:w-auto flex items-center justify-center gap-3 px-6 py-4 bg-stone-800 text-white rounded-full text-[10px] font-black uppercase tracking-widest hover:bg-stone-700 transition-all active:scale-95 shadow-xl hover:shadow-2xl">
                            <span className="w-5 h-5 rounded-full bg-white/20 flex items-center justify-center group-hover:bg-white/30 transition-colors"><Icons.Plus size={12} /></span>
                            Thêm việc mới
                         </button>
                    </div>

                    <div className="space-y-3">
                        {pending.length > 0 ? pending.map((t, idx) => (
                            <div key={idx} onClick={() => onToggleTask(tasks.indexOf(t))} className="group p-5 bg-white rounded-[2rem] border border-stone-100 hover:border-stone-300 hover:shadow-lg transition-all cursor-pointer flex items-center gap-5">
                                <div className="w-6 h-6 rounded-lg border-2 border-stone-200 group-hover:border-stone-400 group-hover:bg-stone-50 transition-all shrink-0"></div>
                                <div className="flex-1">
                                    <h4 className="font-bold text-stone-800 text-base leading-tight uppercase">{t.title}</h4>
                                    <span className="inline-block mt-1 text-[9px] font-black uppercase tracking-wider text-stone-400">{t.tag}</span>
                                </div>
                                <button onClick={(e) => { e.stopPropagation(); onDeleteTask(tasks.indexOf(t)); }} className="w-9 h-9 flex items-center justify-center rounded-full text-stone-300 hover:bg-rose-50 hover:text-rose-500 transition-all opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0"><Icons.Trash size={16} /></button>
                            </div>
                        )) : (
                            <div className="py-20 text-center border-2 border-dashed border-stone-200 rounded-[2.5rem] bg-white/50">
                                <p className="text-stone-400 font-bold uppercase text-xs tracking-widest">Mọi việc đã hoàn tất! ✨</p>
                            </div>
                        )}
                    </div>

                    {done.length > 0 && (
                        <div className="pt-8 opacity-60">
                            <h4 className="mb-4 text-[10px] font-black uppercase tracking-widest text-stone-400">Đã hoàn thành ({done.length})</h4>
                            <div className="space-y-2">
                                {done.map((t, i) => (
                                    <div key={i} className="p-4 bg-stone-50 rounded-[1.5rem] border border-stone-100 flex items-center gap-4 text-stone-400">
                                        <div className="w-6 h-6 rounded-lg bg-stone-300 flex items-center justify-center text-white shrink-0"><Icons.Check size={12} /></div>
                                        <div className="flex-1"><h4 className="text-sm font-bold line-through uppercase">{t.title}</h4></div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    <Modal isOpen={isOpen} onClose={() => setIsOpen(false)} title="Công việc mới">
                        <div className="space-y-6 pt-2">
                            <div>
                                <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Tên công việc</label>
                                <input type="text" value={title} onChange={e=>setTitle(e.target.value)} className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-sm font-bold shadow-inner uppercase" placeholder="VD: ĐẶT HOA CƯỚI" autoFocus />
                            </div>
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Phân loại</label>
                                    <div className="relative">
                                        <select value={cat} onChange={e=>setCat(e.target.value)} className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl text-xs md:text-sm font-bold uppercase appearance-none focus:outline-none focus:border-stone-400 focus:bg-white transition-all shadow-inner">
                                            <option value="Đặt tiệc cưới">Tiệc cưới</option>
                                            <option value="Chụp ảnh">Chụp ảnh</option>
                                            <option value="Trang phục">Trang phục</option>
                                            <option value="Khác">Khác</option>
                                        </select>
                                        <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-stone-400"><Icons.ChevronRight size={14} className="rotate-90" /></div>
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Dự chi (VNĐ)</label>
                                    <input type="text" value={cost} onChange={e=>setCost(utils.formatInput(e.target.value))} className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white transition-all text-sm font-bold shadow-inner" placeholder="0" />
                                </div>
                            </div>
                            <div className="pt-6 border-t border-stone-50">
                                <button onClick={handleAdd} className="w-full py-4 bg-stone-800 text-white rounded-full font-black uppercase text-xs tracking-[0.2em] shadow-xl hover:bg-stone-700 active:scale-95 transition-all flex items-center justify-center gap-3"><Icons.Plus size={14} strokeWidth={3}/> Lưu lại</button>
                            </div>
                        </div>
                    </Modal>
                </div>
            );
        };

        const PlannerGuests = ({ guests, onAddGuest, onDeleteGuest }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [name, setName] = useState(""); const [rel, setRel] = useState("Bạn bè"); const [phone, setPhone] = useState("");
            
            const handleAdd = () => { 
                if (name.trim()) { 
                    onAddGuest({ name: name.trim(), relationship: rel, phone, id: Date.now() }); 
                    setName(""); setPhone(""); setIsOpen(false); 
                } 
            };

            const relationshipColors = {
                "Bạn bè": "bg-blue-50 text-blue-600",
                "Gia đình": "bg-rose-50 text-rose-600",
                "Đồng nghiệp": "bg-purple-50 text-purple-600",
                "Khác": "bg-stone-50 text-stone-600"
            };

            return (
                <div className="max-w-6xl mx-auto space-y-8 animate-in px-2 md:px-0">
                    <div className="flex flex-col md:flex-row justify-between items-end md:items-center gap-4">
                         <div className="text-left w-full md:w-auto">
                            <h3 className="text-2xl font-black text-stone-700 uppercase tracking-tighter">Danh sách khách mời</h3>
                            <p className="text-[10px] font-bold text-stone-400 uppercase tracking-widest mt-1">
                                Tổng cộng: <span className="text-stone-700">{guests?.length || 0}</span> người
                            </p>
                         </div>
                         <button 
                            onClick={() => setIsOpen(true)} 
                            className="group w-full md:w-auto flex items-center justify-center gap-3 px-6 py-4 bg-stone-800 text-white rounded-full text-[10px] font-black uppercase tracking-widest hover:bg-stone-700 transition-all active:scale-95 shadow-xl hover:shadow-2xl"
                        >
                            <span className="w-5 h-5 rounded-full bg-white/20 flex items-center justify-center group-hover:bg-white/30 transition-colors">
                                <Icons.Plus size={12} />
                            </span>
                            Thêm khách mới
                         </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {guests?.length === 0 ? (
                            <div className="col-span-full py-16 text-center border-2 border-dashed border-stone-200 rounded-[2.5rem] bg-white/50">
                                <div className="w-16 h-16 bg-stone-100 rounded-full flex items-center justify-center mx-auto mb-4 text-stone-400 shadow-inner">
                                    <Icons.Users size={24} />
                                </div>
                                <p className="text-stone-400 font-bold uppercase text-[10px] tracking-widest">Danh sách trống</p>
                                <button onClick={() => setIsOpen(true)} className="mt-2 text-[11px] font-black underline uppercase text-stone-600 hover:text-stone-900 transition-colors">Thêm khách đầu tiên</button>
                            </div>
                        ) : (
                            guests?.map((g) => (
                                <div key={g.id} className="group bg-white p-5 rounded-[2rem] border border-stone-100 hover:border-stone-300 hover:shadow-lg transition-all flex items-center justify-between cursor-default">
                                    <div className="flex items-center gap-4">
                                        <div className={`w-12 h-12 rounded-2xl flex items-center justify-center text-sm font-black uppercase shadow-inner shrink-0 ${relationshipColors[g.relationship] || 'bg-stone-100 text-stone-500'}`}>
                                            {g.name.charAt(0)}
                                        </div>
                                        <div className="text-left">
                                            <h4 className="font-bold text-stone-700 text-sm md:text-base leading-tight uppercase">{g.name}</h4>
                                            <div className="flex items-center gap-2 mt-1.5 flex-wrap">
                                                <span className="text-[9px] font-black uppercase tracking-wider text-stone-400 border border-stone-100 px-2 py-0.5 rounded-lg bg-stone-50">
                                                    {g.relationship}
                                                </span>
                                                {g.phone && <span className="text-[10px] font-bold text-stone-400 tabular-nums tracking-wide">{g.phone}</span>}
                                            </div>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={() => onDeleteGuest(g.id)} 
                                        className="w-9 h-9 flex items-center justify-center rounded-full text-stone-300 hover:bg-rose-50 hover:text-rose-500 transition-all opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0"
                                    >
                                        <Icons.Trash size={16} />
                                    </button>
                                </div>
                            ))
                        )}
                    </div>
                    
                    <Modal isOpen={isOpen} onClose={() => setIsOpen(false)} title="Thêm khách mời">
                        <div className="space-y-6 pt-2">
                            <div className="space-y-5 text-left">
                                <div>
                                    <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Họ và tên</label>
                                    <input 
                                        type="text" 
                                        value={name} 
                                        onChange={e => setName(e.target.value)} 
                                        className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-sm font-bold text-stone-700 placeholder:text-stone-300 uppercase" 
                                        placeholder="NHẬP TÊN KHÁCH MỜI..." 
                                        autoFocus
                                    />
                                </div>
                                
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Mối quan hệ</label>
                                        <div className="relative">
                                            <select 
                                                value={rel} 
                                                onChange={e => setRel(e.target.value)} 
                                                className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl appearance-none font-bold text-xs md:text-sm text-stone-700 focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all uppercase"
                                            >
                                                <option value="Bạn bè">Bạn bè</option>
                                                <option value="Gia đình">Gia đình</option>
                                                <option value="Đồng nghiệp">Đồng nghiệp</option>
                                                <option value="Khác">Khác</option>
                                            </select>
                                            <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-stone-400">
                                                <Icons.ChevronRight size={14} className="rotate-90" />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2.5 ml-1">Số điện thoại</label>
                                        <input 
                                            type="text" 
                                            value={phone} 
                                            onChange={e => setPhone(utils.formatInput(e.target.value))} 
                                            className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-xs md:text-sm font-bold text-stone-700 placeholder:text-stone-300 tabular-nums tracking-wider" 
                                            placeholder="09..." 
                                        />
                                    </div>
                                </div>
                            </div>

                            <div className="pt-6 border-t border-stone-50">
                                <button 
                                    onClick={handleAdd} 
                                    className="w-full py-4 bg-stone-800 text-white rounded-full font-black uppercase text-xs tracking-[0.2em] shadow-xl hover:bg-stone-700 active:scale-95 transition-all flex items-center justify-center gap-3"
                                >
                                    <Icons.Plus size={14} strokeWidth={3} /> Lưu khách mời
                                </button>
                            </div>
                        </div>
                    </Modal>
                </div>
            );
        };

        // --- NEW: Mobile Bottom Navigation Component ---
        const MobileNav = ({ activeTab, onNavigate }) => (
            <div className="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-xl border-t border-stone-200 p-2 md:hidden z-50 pb-safe">
                <div className="flex justify-around items-center">
                    {[{id: 'home', icon: Icons.Home, label: 'Home'}, {id: 'planner', icon: Icons.Layout, label: 'Planner'}, {id: 'invitation', icon: Icons.Link, label: 'Thiệp'}, {id: 'vendors', icon: Icons.Star, label: 'Dịch vụ'}].map(item => (
                        <button key={item.id} onClick={() => onNavigate(item.id)} className={`flex flex-col items-center gap-1 p-2 rounded-xl transition-all ${activeTab === item.id ? 'text-stone-800 bg-stone-100' : 'text-stone-400'}`}>
                            <item.icon size={20} fill={activeTab === item.id ? "currentColor" : "none"} strokeWidth={activeTab === item.id ? 2.5 : 2} />
                            <span className="text-[9px] font-black uppercase tracking-wider">{item.label}</span>
                        </button>
                    ))}
                </div>
            </div>
        );

        // --- NEW: Footer Component ---
        const Footer = () => (
            <footer className="bg-white/50 backdrop-blur-sm border-t border-stone-100 py-12 mt-12 mb-20 md:mb-0">
                <div className="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6 text-center md:text-left">
                    <div>
                        <h4 className="text-lg font-black text-stone-700 uppercase tracking-tighter mb-2">Weddy</h4>
                        <p className="text-stone-400 text-xs max-w-xs font-medium leading-relaxed">
                            Nền tảng lập kế hoạch đám cưới tinh tế, giúp bạn và người ấy đồng hành trên hành trình hạnh phúc.
                        </p>
                    </div>
                    <div className="flex flex-wrap justify-center gap-6">
                        {['Về chúng tôi', 'Điều khoản', 'Riêng tư', 'Liên hệ'].map(item => (
                            <a key={item} href="#" className="text-[10px] font-black uppercase tracking-widest text-stone-400 hover:text-stone-600 transition-colors">
                                {item}
                            </a>
                        ))}
                    </div>
                    <div className="text-[10px] font-bold text-stone-300 uppercase tracking-widest">
                        © 2024 Weddy. All rights reserved.
                    </div>
                </div>
            </footer>
        );

        // --- 6. LOGIC WRAPPER FOR PLANNER ---
        const FullPlannerApp = ({ currentUser, firebase }) => {
            const [subTab, setSubTab] = useState('overview');
            const [userData, setUserData] = useState(null);
            const [isBudgetModalOpen, setIsBudgetModalOpen] = useState(false);
            const [isGuestModalOpen, setIsGuestModalOpen] = useState(false);
            const [isJoinModalOpen, setIsJoinModalOpen] = useState(false);
            const [isInviteShowModal, setIsInviteShowModal] = useState(false);
            const [inviteCode, setInviteCode] = useState("");
            const [joinInput, setJoinInput] = useState("");
            const [tempBudget, setTempBudget] = useState("");

            useEffect(() => {
                if (!firebase || !currentUser) return;
                const { db, onSnapshot, doc, setDoc, getDoc, updateDoc } = firebase;
                const profileRef = doc(db, 'artifacts', APP_ID, 'users', currentUser.uid, 'profile', 'main');
                
                let unsubWedding = () => {};
                let currentWeddingId = null;

                const unsubProfile = onSnapshot(profileRef, async (snap) => {
                    if (!snap.exists()) {
                        await setDoc(profileRef, { 
                            email: currentUser.email, 
                            name: currentUser.displayName, 
                            weddingId: null, 
                            isSetupComplete: false 
                        });
                        return;
                    }

                    const pv = snap.data();
                    const wid = pv.weddingId;

                    if (!wid) {
                        const newWid = currentUser.uid;
                        await updateDoc(profileRef, { weddingId: newWid });
                        const wRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'weddings', newWid);
                        const wSnap = await getDoc(wRef);
                        if (!wSnap.exists()) {
                            await setDoc(wRef, { 
                                tasks: [], guests: [], activities: [], 
                                budgetLimit: 300000000, owners: [currentUser.uid] 
                            });
                        }
                        return;
                    }

                    if (wid !== currentWeddingId) {
                        currentWeddingId = wid;
                        unsubWedding();
                        unsubWedding = onSnapshot(doc(db, 'artifacts', APP_ID, 'public', 'data', 'weddings', wid), (wSnap) => {
                            if (wSnap.exists()) {
                                setUserData(prev => ({ 
                                    ...wSnap.data(), 
                                    weddingId: wid, 
                                    profile: pv
                                }));
                            }
                        });
                    } else {
                        setUserData(prev => prev ? ({ ...prev, profile: pv }) : null);
                    }

                }, (err) => console.error("Profile Error:", err));

                return () => { unsubProfile(); unsubWedding(); };
            }, [firebase, currentUser]);

            if (!userData) return <div className="h-screen flex items-center justify-center text-stone-400"><div className="w-8 h-8 border-4 border-stone-300 border-t-transparent rounded-full animate-spin"></div></div>;

            if (!userData.profile?.isSetupComplete) {
                const onWiz = async (w) => {
                    const { db, doc, updateDoc } = firebase;
                    const pref = doc(db, 'artifacts', APP_ID, 'users', currentUser.uid, 'profile', 'main');
                    await updateDoc(pref, { role: w.role, weddingDate: w.date, location: w.location, isSetupComplete: true, name: currentUser.displayName || userData.profile.name });
                    if (userData.weddingId) {
                        await updateDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'weddings', userData.weddingId), { budgetLimit: w.budget || 300000000 });
                    }
                };
                return <GettingStartedWizard onComplete={onWiz} />;
            }

            const updateDB = async (k, v) => { await firebase.updateDoc(firebase.doc(firebase.db, 'artifacts', APP_ID, 'public', 'data', 'weddings', userData.weddingId), { [k]: v }); };
            const addAct = async (t) => { const n = { text: t, time: new Date().toLocaleTimeString('vi-VN') }; await updateDB('activities', [n, ...(userData.activities || [])].slice(0, 15)); };
            
            const onAddTask = async (t) => { 
                const nt = [{...t, paidBy: userData.profile?.role}, ...(userData.tasks || [])]; 
                await updateDB('tasks', nt); await addAct(`Thêm: ${t.title}`); 
            };
            const onToggleTask = async (idx) => { 
                const nt = [...(userData.tasks || [])]; nt[idx].status = nt[idx].status === 'done' ? 'pending' : 'done'; 
                await updateDB('tasks', nt); await addAct(`Cập nhật: ${nt[idx].title}`); 
            };
            const onDeleteTask = async (idx) => { 
                const nt = (userData.tasks || []).filter((_, i) => i !== idx); 
                await updateDB('tasks', nt); await addAct(`Xóa 1 công việc`); 
            };
            const onAddGuest = async (g) => { 
                const ng = [g, ...(userData.guests || [])]; 
                await updateDB('guests', ng); await addAct(`Khách mới: ${g.name}`); 
            };
            const onDeleteGuest = async (id) => { 
                const ng = (userData.guests || []).filter(x => x.id !== id); 
                await updateDB('guests', ng); await addAct(`Xóa khách`); 
            };

            const handleInvite = async () => {
                const code = Math.floor(100000 + Math.random() * 900000).toString();
                await firebase.setDoc(firebase.doc(firebase.db, 'artifacts', APP_ID, 'public', 'data', 'invites', code), { weddingId: userData.weddingId, createdAt: Date.now() });
                setInviteCode(code); setIsInviteShowModal(true);
            };

            const joinSync = async () => {
                const { db, doc, getDoc, updateDoc } = firebase;
                const snap = await getDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'invites', joinInput.toUpperCase()));
                if (snap.exists()) {
                    await updateDoc(doc(db, 'artifacts', APP_ID, 'users', currentUser.uid, 'profile', 'main'), { weddingId: snap.data().weddingId });
                    setIsJoinModalOpen(false); alert("Đồng bộ Planner thành công!");
                } else alert("Mã không hợp lệ.");
            };

            const spentAmount = (userData.tasks || []).reduce((acc, t) => acc + (t.paid ?? (t.status === 'done' ? t.cost : 0)), 0);

            return (
                <div className="pt-24 pb-32 md:pt-32 container mx-auto px-4 md:px-12 max-w-7xl animate-in text-stone-700">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 md:mb-16 gap-6 px-2 md:px-0 text-left font-bold uppercase">
                            <div className="flex-1 w-full text-stone-600 text-left font-bold uppercase font-black uppercase font-bold text-left font-black uppercase font-bold"><span className="text-[10px] tracking-[0.3em] text-[#B5A896] mb-2 block">Planner của {userData.profile?.name || 'bạn'}</span><h2 className="text-3xl md:text-5xl tracking-tighter">Weddy Planner</h2></div>
                        <div className="flex flex-col sm:flex-row gap-4 w-full md:w-auto text-left font-bold uppercase font-black uppercase font-bold">
                            <div className="bg-white/70 p-5 md:p-6 rounded-[2.5rem] border border-stone-100 shadow-sm flex items-center gap-6 flex-1 min-w-0 sm:min-w-[280px] font-bold uppercase font-black uppercase font-bold">
                                <div className="w-10 h-10 md:w-12 md:h-12 bg-rose-100/40 rounded-full flex items-center justify-center text-rose-300 shrink-0 shadow-inner"><Icons.Heart size={20} fill="currentColor"/></div>
                                <div className="flex-1 text-sm overflow-hidden text-left font-bold uppercase font-black uppercase font-bold font-bold uppercase font-black uppercase font-bold uppercase font-black font-bold uppercase font-black uppercase font-bold"><p className="text-[9px] font-black tracking-widest text-stone-300 mb-1 text-left uppercase font-black">Ngày trọng đại</p><div className="flex items-baseline gap-2 md:gap-3 font-bold text-left font-bold uppercase font-black uppercase font-bold font-bold uppercase font-black uppercase font-bold uppercase font-black uppercase font-bold text-left"><p className="text-base md:text-xl font-bold text-stone-600 truncate text-left">{userData.profile?.weddingDate || 'Chưa đặt'}</p><p className="text-[10px] font-bold text-rose-400 whitespace-nowrap uppercase text-left">{utils.getDaysLeft(userData.profile?.weddingDate)}</p></div></div>
                            </div>
                            <button onClick={() => setIsJoinModalOpen(true)} className="bg-stone-500 text-white p-5 md:p-6 rounded-[2.5rem] shadow-xl hover:bg-stone-600 active:scale-95 flex items-center justify-center gap-4 transition-all shrink-0 font-bold uppercase font-black uppercase font-bold uppercase font-black font-bold uppercase font-black uppercase font-bold"><Icons.Link size={20}/><span className="text-xs">Nhập mã kết nối</span></button>
                        </div>
                    </div>

                    <div className="flex justify-center mb-10 md:mb-16 -mx-4 px-4 md:mx-0 md:px-0 font-bold uppercase font-black uppercase font-bold">
                        <div className="bg-white/40 p-1.5 rounded-full flex w-full max-w-6xl border border-white/60 backdrop-blur-sm overflow-x-auto hide-scrollbar font-bold uppercase font-black uppercase font-bold">
                            {[{ id: 'overview', label: 'Tổng quan', icon: Icons.Layout }, { id: 'tasks', label: 'Công việc', icon: Icons.Check }, { id: 'budget', label: 'Ngân sách', icon: Icons.DollarSign }, { id: 'guests', label: 'Khách mời', icon: Icons.Users }].map((tab) => (
                                <button key={tab.id} onClick={() => setSubTab(tab.id)} className={`flex-1 flex items-center justify-center gap-2 px-6 md:px-10 py-4 md:py-5 rounded-full text-[10px] md:text-sm tracking-widest transition-all whitespace-nowrap ${subTab === tab.id ? 'bg-stone-500 text-white shadow-xl scale-105 font-bold uppercase' : 'text-stone-400 hover:text-stone-700 hover:bg-white/50 font-bold uppercase font-bold uppercase font-black uppercase font-bold'}`}><tab.icon size={16} strokeWidth={3} className="md:w-[18px] md:h-[18px]" />{tab.label}</button>
                            ))}
                        </div>
                    </div>

                    <div className="px-1 md:px-0 font-bold uppercase font-black uppercase font-bold">
                        {subTab === 'overview' && <PlannerOverview spentAmount={spentAmount} completedTasks={userData.tasks.filter(t=>t.status==='done').length} totalTasks={userData.tasks.length} guestCount={userData.guests.length} budgetLimit={userData.budgetLimit} role={userData.profile?.role} weddingDate={userData.profile?.weddingDate} activities={userData.activities} onInvite={handleInvite} onEditBudget={() => { setTempBudget(utils.formatInput(userData.budgetLimit)); setIsBudgetModalOpen(true); }} onOpenGuests={() => setIsGuestModalOpen(true)} />}
                        {subTab === 'tasks' && <PlannerTasks tasks={userData.tasks} onAddTask={onAddTask} onToggleTask={onToggleTask} onDeleteTask={onDeleteTask} />}
                        {subTab === 'budget' && <PlannerBudget tasks={userData.tasks} onAddExpense={onAddTask} />}
                        {subTab === 'guests' && <PlannerGuests guests={userData.guests} onAddGuest={onAddGuest} onDeleteGuest={onDeleteGuest} />}
                    </div>

                    <Modal isOpen={isBudgetModalOpen} onClose={() => setIsBudgetModalOpen(false)} title="Ngân sách dự kiến"><div className="space-y-6 pt-4 text-stone-700 text-left font-bold uppercase font-black uppercase font-bold"><input type="text" value={tempBudget} onChange={(e) => setTempBudget(utils.formatInput(e.target.value))} className="w-full p-4 bg-white border border-stone-200 rounded-2xl focus:outline-none focus:border-stone-400 font-bold text-lg text-stone-800 shadow-sm shadow-inner uppercase" placeholder="0" /><button onClick={async () => { const nb = utils.parseInput(tempBudget); if (nb > 0) { await updateDB('budgetLimit', nb); setIsBudgetModalOpen(false); } }} className="w-full py-4 bg-stone-500 text-white rounded-full font-black uppercase text-xs shadow-lg hover:bg-stone-600 transition-all font-bold active:scale-95 uppercase font-black uppercase font-bold">Lưu lại</button></div></Modal>
                    <Modal isOpen={isGuestModalOpen} onClose={() => setIsGuestModalOpen(false)} title="Khách mời"><PlannerGuests guests={userData.guests} onAddGuest={onAddGuest} onDeleteGuest={onDeleteGuest} /></Modal>
                    <Modal isOpen={isInviteShowModal} onClose={() => setIsInviteShowModal(false)} title="Mã kết nối"><div className="text-center space-y-6 pt-2 font-bold uppercase font-black uppercase font-bold uppercase font-black"><p className="text-xs text-stone-400 font-black tracking-widest leading-relaxed px-4 uppercase font-black font-black uppercase font-bold">Hãy chia sẻ mã này để đồng bộ Planner.</p><div className="bg-stone-50 p-10 rounded-3xl border-2 border-dashed border-stone-200 font-bold font-black uppercase font-bold"><h2 className="text-5xl font-black tracking-[0.4em] text-stone-700">{inviteCode}</h2></div><button onClick={() => setIsInviteShowModal(false)} className="w-full py-4 bg-stone-500 text-white rounded-full font-black uppercase text-xs shadow-lg font-bold uppercase font-black uppercase font-bold">Đóng</button></div></Modal>
                    <Modal isOpen={isJoinModalOpen} onClose={() => setIsJoinModalOpen(false)} title="Đồng bộ Planner"><div className="space-y-6 pt-4 text-center font-bold font-medium text-stone-700 uppercase font-black uppercase font-bold uppercase font-black"><p className="text-xs text-stone-400 font-black tracking-widest leading-relaxed px-4 uppercase font-black font-black uppercase font-bold">Nhập mã 6 ký tự nhận được để kết nối.</p><input type="text" value={joinInput} onChange={e=>setJoinInput(e.target.value.toUpperCase())} maxLength={6} className="w-full p-6 bg-stone-50 border-2 border-dashed border-stone-200 rounded-3xl focus:outline-none focus:border-stone-400 text-4xl font-black tracking-[0.4em] text-center text-stone-600 font-bold shadow-inner font-black uppercase font-bold" placeholder="000000" /><button onClick={joinSync} className="w-full py-4 bg-stone-500 text-white rounded-full font-black uppercase text-xs shadow-lg font-bold transition-all active:scale-95 uppercase uppercase font-black uppercase font-bold">Đồng bộ ngay</button></div></Modal>
                </div>
            );
        };

        const HomeView = ({ onNavigate }) => {
            return (
                <div className="pt-32 pb-20 px-4 max-w-7xl mx-auto text-center animate-in">
                    <div className="mb-12">
                        <div className="inline-block px-4 py-2 bg-rose-50 rounded-full text-rose-500 text-xs font-black uppercase tracking-widest mb-6">Weddy Planner</div>
                        <h1 className="text-5xl md:text-7xl font-black text-stone-800 mb-6 tracking-tighter">
                            Kế hoạch cưới <br/>
                            <span className="text-silk">Tinh tế & Hoàn hảo</span>
                        </h1>
                        <p className="text-stone-500 max-w-2xl mx-auto text-lg mb-10 leading-relaxed">
                            Weddy giúp bạn quản lý ngân sách, danh sách khách mời và công việc cần làm cho ngày trọng đại một cách dễ dàng và đồng bộ cùng người ấy.
                        </p>
                        <button 
                            onClick={() => onNavigate('planner')}
                            className="px-10 py-5 bg-stone-800 text-white rounded-full font-black uppercase tracking-widest shadow-xl hover:bg-stone-700 hover:scale-105 transition-all active:scale-95"
                        >
                            Bắt đầu ngay
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                        {[
                            { title: "Quản lý Ngân sách", desc: "Theo dõi chi tiêu chi tiết, tránh phát sinh ngoài ý muốn.", icon: Icons.DollarSign },
                            { title: "Danh sách Khách mời", desc: "Lưu trữ thông tin, sắp xếp chỗ ngồi và quản lý thiệp mời.", icon: Icons.Users },
                            { title: "Đồng bộ Real-time", desc: "Cập nhật tức thì giữa cô dâu và chú rể trên mọi thiết bị.", icon: Icons.Link }
                        ].map((item, i) => (
                            <div key={i} className="bg-white/60 p-8 rounded-[2.5rem] border border-stone-100 hover:border-stone-200 transition-all">
                                <div className="w-12 h-12 bg-white rounded-2xl flex items-center justify-center mb-6 shadow-sm text-stone-600">
                                    <item.icon />
                                </div>
                                <h3 className="text-lg font-bold text-stone-800 mb-2">{item.title}</h3>
                                <p className="text-sm text-stone-500 leading-relaxed">{item.desc}</p>
                            </div>
                        ))}
                    </div>
                </div>
            )
        }

        // --- NEW: COMING SOON COMPONENT ---
        const ComingSoon = ({ title, desc }) => (
            <div className="pt-32 pb-20 px-4 max-w-7xl mx-auto text-center animate-in min-h-[60vh] flex flex-col items-center justify-center">
                <div className="w-24 h-24 bg-stone-100 rounded-full flex items-center justify-center mb-8 text-stone-300 shadow-inner">
                    <Icons.Star size={40} />
                </div>
                <h2 className="text-3xl md:text-5xl font-black text-stone-700 mb-4 tracking-tighter uppercase">{title}</h2>
                <p className="text-stone-400 max-w-md mx-auto text-sm md:text-base font-bold uppercase tracking-widest leading-relaxed mb-8">
                    {desc}
                </p>
                <div className="inline-block px-6 py-3 bg-stone-50 rounded-full text-[10px] font-black uppercase tracking-[0.2em] text-stone-400 border border-stone-100">
                    Đang phát triển
                </div>
            </div>
        );

        // --- 7. TOP LEVEL APP CONTAINER ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [scrolled, setScrolled] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [user, setUser] = useState(null);
            const [notifications, setNotifications] = useState([]);
            const [showNotifications, setShowNotifications] = useState(false);
            const firebase = useFirebase();
            const notificationRef = useRef(null);

            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            useEffect(() => {
                if (firebase) {
                    const unsubAuth = firebase.onAuthStateChanged(firebase.auth, (u) => { 
                        setUser(u); if (u) setShowLogin(false);
                    });
                    return () => unsubAuth();
                }
            }, [firebase]);

            useEffect(() => {
                if (firebase && user) {
                    const { db, doc, onSnapshot } = firebase;
                    const unsubProfile = onSnapshot(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'profile', 'main'), (pSnap) => {
                        if (pSnap.exists() && pSnap.data().weddingId) {
                            onSnapshot(doc(db, 'artifacts', APP_ID, 'public', 'data', 'weddings', pSnap.data().weddingId), (wSnap) => {
                                if (wSnap.exists()) setNotifications(wSnap.data().activities || []);
                            });
                        }
                    });
                    return () => unsubProfile();
                }
            }, [firebase, user]);

            useEffect(() => {
                const handleClickOutside = (e) => { if (notificationRef.current && !notificationRef.current.contains(e.target)) setShowNotifications(false); };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const navigateTo = (tab) => { 
                if (tab !== 'home' && tab !== 'invitation' && tab !== 'vendors' && !user) { setShowLogin(true); return; } 
                setActiveTab(tab); window.scrollTo({ top: 0, behavior: 'smooth' }); 
            };
            
            const handleGoogleLogin = async () => {
                const { auth, db, GoogleAuthProvider, signInWithPopup, doc, getDoc, setDoc } = firebase;
                try {
                    const result = await signInWithPopup(auth, new GoogleAuthProvider());
                    const profileRef = doc(db, 'artifacts', APP_ID, 'users', result.user.uid, 'profile', 'main');
                    if (!(await getDoc(profileRef)).exists()) await setDoc(profileRef, { email: result.user.email, name: result.user.displayName, weddingId: null, isSetupComplete: false });
                    setActiveTab('planner');
                } catch (e) { console.error(e); alert("Lỗi đăng nhập Google: " + e.message); }
            };

            const AuthForm = () => {
                const [isRegister, setIsRegister] = useState(false);
                const [email, setEmail] = useState(""); 
                const [password, setPassword] = useState(""); 
                const [name, setName] = useState("");
                const [error, setError] = useState("");
                const [loading, setLoading] = useState(false);

                const handleSubmit = async () => { 
                    setError("");
                    setLoading(true);
                    try {
                        if (isRegister) {
                            if (!name.trim()) throw new Error("Vui lòng nhập họ tên.");
                            const { user } = await firebase.createUserWithEmailAndPassword(firebase.auth, email, password);
                            // Create profile doc directly
                            await firebase.setDoc(firebase.doc(firebase.db, 'artifacts', APP_ID, 'users', user.uid, 'profile', 'main'), { 
                                email: user.email, 
                                name: name, 
                                weddingId: null, 
                                isSetupComplete: false 
                            });
                        } else {
                            await firebase.signInWithEmailAndPassword(firebase.auth, email, password);
                        }
                        setActiveTab('planner'); 
                    } catch (err) { 
                        let msg = "Đã có lỗi xảy ra.";
                        if (err.code === 'auth/invalid-email') msg = "Email không hợp lệ.";
                        if (err.code === 'auth/user-not-found' || err.code === 'auth/wrong-password' || err.code === 'auth/invalid-credential') msg = "Sai email hoặc mật khẩu.";
                        if (err.code === 'auth/email-already-in-use') msg = "Email này đã được đăng ký.";
                        if (err.code === 'auth/weak-password') msg = "Mật khẩu quá yếu (tối thiểu 6 ký tự).";
                        if (err.message) msg = err.message;
                        setError(msg); 
                    } finally {
                        setLoading(false);
                    }
                };

                return (
                    <div className="pt-2 animate-in">
                        {/* Tabs Switcher */}
                        <div className="flex bg-stone-100 p-1 rounded-2xl mb-8 relative">
                            <div 
                                className={`absolute top-1 bottom-1 left-1 w-[calc(50%-4px)] bg-white rounded-xl shadow-sm transition-all duration-300 ease-out transform ${isRegister ? 'translate-x-full' : 'translate-x-0'}`}
                            ></div>
                            <button 
                                onClick={() => { setIsRegister(false); setError(""); }} 
                                className={`flex-1 py-3 text-[10px] font-black uppercase tracking-widest relative z-10 transition-colors ${!isRegister ? 'text-stone-800' : 'text-stone-400 hover:text-stone-600'}`}
                            >
                                Đăng nhập
                            </button>
                            <button 
                                onClick={() => { setIsRegister(true); setError(""); }} 
                                className={`flex-1 py-3 text-[10px] font-black uppercase tracking-widest relative z-10 transition-colors ${isRegister ? 'text-stone-800' : 'text-stone-400 hover:text-stone-600'}`}
                            >
                                Đăng ký
                            </button>
                        </div>

                        <div className="space-y-5 text-left">
                            {isRegister && (
                                <div className="animate-in">
                                    <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2 ml-1">Họ và tên</label>
                                    <input 
                                        type="text" 
                                        value={name} 
                                        onChange={e => setName(e.target.value)} 
                                        className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-sm font-bold text-stone-700 placeholder:text-stone-300 uppercase" 
                                        placeholder="VD: NGUYỄN VĂN A" 
                                    />
                                </div>
                            )}
                            
                            <div>
                                <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2 ml-1">Email</label>
                                <input 
                                    type="email" 
                                    value={email} 
                                    onChange={e => setEmail(e.target.value)} 
                                    className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-sm font-bold text-stone-700 placeholder:text-stone-300 uppercase" 
                                    placeholder="WEDDY@EXAMPLE.COM" 
                                />
                            </div>

                            <div>
                                <label className="block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mb-2 ml-1">Mật khẩu</label>
                                <input 
                                    type="password" 
                                    value={password} 
                                    onChange={e => setPassword(e.target.value)} 
                                    className="w-full p-4 bg-stone-50 border border-stone-100 rounded-2xl focus:outline-none focus:border-stone-400 focus:bg-white focus:shadow-md transition-all text-sm font-bold text-stone-700 placeholder:text-stone-300 uppercase" 
                                    placeholder="••••••••" 
                                />
                            </div>

                            {error && (
                                <div className="p-3 bg-rose-50 text-rose-500 rounded-xl text-xs font-bold uppercase tracking-wide text-center animate-in">
                                    <Icons.X size={12} className="inline mr-1" /> {error}
                                </div>
                            )}

                            <button 
                                onClick={handleSubmit} 
                                disabled={loading}
                                className="w-full py-4 mt-2 bg-stone-800 text-white rounded-full font-black uppercase text-xs tracking-[0.2em] shadow-xl hover:bg-stone-700 active:scale-95 transition-all flex items-center justify-center gap-3 disabled:opacity-70 disabled:cursor-not-allowed"
                            >
                                {loading ? <span className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span> : (isRegister ? 'Tạo tài khoản' : 'Vào hệ thống')}
                            </button>
                        </div>

                        <div className="relative flex py-6 items-center">
                            <div className="flex-grow border-t border-stone-100"></div>
                            <span className="flex-shrink-0 mx-4 text-stone-300 text-[9px] font-black uppercase tracking-widest">Hoặc</span>
                            <div className="flex-grow border-t border-stone-100"></div>
                        </div>

                        <button 
                            onClick={handleGoogleLogin} 
                            className="w-full py-4 bg-white border border-stone-200 text-stone-600 rounded-full text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-3 shadow-sm hover:bg-stone-50 hover:border-stone-300 active:scale-95 transition-all"
                        >
                            <svg className="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                            Tiếp tục với Google
                        </button>
                    </div>
                );
            };

            // --- NEW: Footer Component ---
            const Footer = () => (
                <footer className="bg-white/50 backdrop-blur-sm border-t border-stone-100 py-12 mt-12 mb-20 md:mb-0">
                    <div className="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6 text-center md:text-left">
                        <div>
                            <h4 className="text-lg font-black text-stone-700 uppercase tracking-tighter mb-2">Weddy</h4>
                            <p className="text-stone-400 text-xs max-w-xs font-medium leading-relaxed">
                                Nền tảng lập kế hoạch đám cưới tinh tế, giúp bạn và người ấy đồng hành trên hành trình hạnh phúc.
                            </p>
                        </div>
                        <div className="flex flex-wrap justify-center gap-6">
                            {['Về chúng tôi', 'Điều khoản', 'Riêng tư', 'Liên hệ'].map(item => (
                                <a key={item} href="#" className="text-[10px] font-black uppercase tracking-widest text-stone-400 hover:text-stone-600 transition-colors">
                                    {item}
                                </a>
                            ))}
                        </div>
                        <div className="text-[10px] font-bold text-stone-300 uppercase tracking-widest">
                            © 2024 Weddy. All rights reserved.
                        </div>
                    </div>
                </footer>
            );

            return (
                <div className="min-h-screen">
                    <div className="fixed top-4 md:top-6 left-0 w-full z-50 flex justify-center px-4 transition-all duration-500">
                        <nav className={`flex items-center justify-between px-5 py-2 md:px-6 md:py-2.5 rounded-full transition-all duration-500 ${scrolled ? 'w-full max-w-5xl bg-white/75 backdrop-blur-2xl border border-white/20 shadow-lg' : 'w-full max-w-6xl bg-white/40 backdrop-blur-md border border-white/10'}`}>
                            <div className="flex items-center gap-2 cursor-pointer group font-bold uppercase font-black uppercase font-bold" onClick={() => navigateTo('home')}><div className="w-8 h-8 bg-stone-500 text-white rounded-full flex items-center justify-center group-hover:scale-110 transition-transform shadow-sm shadow-inner font-bold uppercase font-black uppercase font-bold"><Icons.Heart size={16} fill="currentColor" /></div><span className="text-base md:text-lg font-black tracking-tighter uppercase text-stone-600 font-bold uppercase font-black uppercase font-bold">Weddy</span></div>
                            <div className="hidden md:flex items-center gap-1 font-bold uppercase tracking-widest uppercase font-black uppercase font-black uppercase font-bold">{[{ id: 'home', label: 'Trang chủ' }, { id: 'planner', label: 'Planner' }, { id: 'invitation', label: 'Thiệp mời' }, { id: 'vendors', label: 'Dịch vụ' }].map((item) => (<button key={item.id} onClick={() => navigateTo(item.id)} className={`text-[10px] px-5 py-2.5 rounded-full transition-all ${activeTab === item.id ? 'bg-stone-500 text-white shadow-lg font-bold uppercase font-black uppercase font-bold' : 'text-stone-400 hover:text-stone-700 hover:bg-white/50 font-bold uppercase font-black uppercase font-bold'}`}>{item.label}</button>))}</div>
                            <div className="flex items-center gap-2 md:gap-3 font-bold uppercase font-black uppercase font-bold">
                                {user && <span className="hidden lg:block text-[9px] font-black uppercase tracking-[0.2em] text-stone-400 mr-2 truncate max-w-[120px] font-bold uppercase uppercase font-black uppercase font-bold">{user.displayName || user.email}</span>}
                                {user && (
                                    <div className="relative font-bold uppercase font-black uppercase font-bold" ref={notificationRef}>
                                        <button onClick={() => setShowNotifications(!showNotifications)} className="w-9 h-9 md:w-10 md:h-10 bg-white/80 backdrop-blur-sm rounded-full flex items-center justify-center text-stone-300 hover:text-stone-600 border border-stone-100 shadow-sm transition-colors relative shadow-inner font-bold uppercase font-black uppercase font-bold"><Icons.Bell size={18} />{notifications.length > 0 && (<span className="absolute top-2.5 right-2.5 w-1.5 h-1.5 bg-rose-400 rounded-full border border-white font-bold uppercase font-black uppercase font-bold"></span>)}</button>
                                        {showNotifications && (
                                            <div className="absolute right-0 mt-3 w-[280px] md:w-80 bg-white/95 backdrop-blur-xl rounded-[2.5rem] shadow-2xl border border-stone-100 py-6 animate-in zoom-in-95 origin-top-right overflow-hidden z-[60] font-bold uppercase font-black uppercase font-bold">
                                                <div className="px-6 mb-4 flex justify-between items-center text-stone-700 font-bold uppercase font-bold uppercase font-black uppercase font-bold"><h4 className="text-[10px] md:text-xs">Thông báo</h4><span className="text-[9px] text-stone-300 font-bold uppercase uppercase font-black uppercase font-bold">{notifications.length} mới</span></div>
                                                <div className="max-h-96 overflow-y-auto hide-scrollbar px-2 text-stone-600 text-left font-bold font-medium font-bold uppercase font-black uppercase font-bold text-left">
                                                    {notifications.length > 0 ? notifications.map((n, i) => (
                                                        <div key={i} className="p-4 rounded-2xl hover:bg-stone-50 transition-colors flex gap-4 items-start cursor-pointer group text-left font-bold uppercase font-black uppercase font-bold text-left"><div className="w-8 h-8 bg-stone-100 rounded-xl flex items-center justify-center shrink-0 group-hover:bg-stone-200 transition-colors shadow-sm font-bold uppercase font-black uppercase font-bold text-left"><Icons.Heart size={14} className="text-stone-300 font-bold uppercase font-black uppercase font-bold text-left" /></div><div className="flex-1 text-left font-bold text-stone-600 text-left font-bold uppercase font-black uppercase font-bold text-left"><p className="text-xs font-bold leading-snug text-left font-bold uppercase font-black uppercase font-bold text-left">{n.text}</p><p className="text-[9px] font-bold text-stone-400 uppercase mt-1 text-left font-bold uppercase font-black uppercase font-bold text-left">{n.time}</p></div></div>
                                                    )) : <div className="py-10 text-center text-stone-300 text-xs italic font-bold uppercase tracking-widest font-medium text-center uppercase font-black uppercase uppercase font-black uppercase font-bold text-center">Không có thông báo mới</div>}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                                {user ? <button onClick={() => firebase.signOut(firebase.auth)} className="hidden sm:block px-5 py-2 md:px-6 md:py-2.5 bg-white border border-stone-200 text-stone-500 rounded-full text-[10px] font-black uppercase shadow-sm active:scale-95 font-bold transition-all uppercase font-black uppercase font-bold uppercase font-black uppercase font-bold">Đăng xuất</button> : <button onClick={() => setShowLogin(true)} className="px-5 py-2 md:px-6 md:py-2.5 bg-stone-500 text-white rounded-full text-[10px] font-black uppercase shadow-xl active:scale-95 font-bold transition-all uppercase font-black uppercase font-bold uppercase font-black uppercase font-bold">Đăng nhập</button>}
                            </div>
                        </nav>
                    </div>

                    <main className="pb-safe">
                        {activeTab === 'home' && <HomeView onNavigate={navigateTo} />}
                        {activeTab === 'planner' && (user ? <FullPlannerApp currentUser={user} firebase={firebase} /> : <div className="h-screen flex flex-col gap-4 items-center justify-center text-stone-400 p-6 text-center animate-in font-bold uppercase font-black uppercase font-bold"><Icons.Users size={48} className="opacity-10" /><p className="font-medium text-sm text-stone-300 font-bold uppercase tracking-widest uppercase uppercase font-black uppercase font-bold">Vui lòng đăng nhập Planner.</p><button onClick={() => setShowLogin(true)} className="px-8 py-3 bg-stone-500 text-white rounded-full text-xs font-bold uppercase shadow-lg font-bold transition-all active:scale-95 font-bold uppercase font-black uppercase font-bold">Đăng nhập ngay</button></div>)}
                        {activeTab === 'invitation' && <ComingSoon title="Thiệp Mời Online" desc="Tính năng thiết kế và gửi thiệp mời trực tuyến đang được phát triển." />}
                        {activeTab === 'vendors' && <ComingSoon title="Dịch Vụ Cưới" desc="Hệ thống kết nối nhà cung cấp dịch vụ uy tín sẽ sớm ra mắt." />}
                    </main>

                    {/* Footer Component Added Here */}
                    <Footer />

                    {user && <MobileNav activeTab={activeTab} onNavigate={navigateTo} />}

                    <Modal isOpen={showLogin} onClose={() => setShowLogin(false)} title={null}>
                        <AuthForm />
                    </Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
